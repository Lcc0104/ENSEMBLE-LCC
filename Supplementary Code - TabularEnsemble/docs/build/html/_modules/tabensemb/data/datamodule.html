
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tabensemb.data.datamodule &#8212; Tabular Ensemble 0.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/nbsphinx_dataframe.css?v=60cbb005" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script src="../../../_static/documentation_options.js?v=3b889da3"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/tabensemb/data/datamodule';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    <p class="title logo__title">Tabular Ensemble 0.2 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/get_started.html">
                        Get Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/advanced_usage.html">
                        Advanced Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/api.html">
                        API References
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ANONYMOUS/tabular_ensemble" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/get_started.html">
                        Get Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/advanced_usage.html">
                        Advanced Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/api.html">
                        API References
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ANONYMOUS/tabular_ensemble" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">tabensemb.data.datamodule</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for tabensemb.data.datamodule</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">tabensemb</span>
<span class="kn">from</span> <span class="nn">tabensemb.utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">tabensemb.config</span> <span class="kn">import</span> <span class="n">UserConfig</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span> <span class="k">as</span> <span class="n">cp</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">torch.cuda</span>
<span class="kn">import</span> <span class="nn">torch.utils.data</span> <span class="k">as</span> <span class="nn">Data</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Subset</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">import</span> <span class="nn">sklearn.pipeline</span>
<span class="kn">import</span> <span class="nn">sklearn.ensemble</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>


<div class="viewcode-block" id="DataModule">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.html#tabensemb.data.datamodule.DataModule">[docs]</a>
<span class="k">class</span> <span class="nc">DataModule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The dataset manager that provides loading, processing, and analyzing utilities.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">        A :class:`tabensemb.config.UserConfig` instance.</span>
<span class="sd">    augmented_indices</span>
<span class="sd">        Indices of data points that are augmented by :class:`tabensemb.data.AbstractAugmenter`. The first index starts</span>
<span class="sd">        from the number of data points in the original dataset.</span>
<span class="sd">    cat_feature_mapping</span>
<span class="sd">        Original values of categorical features before ordinal encoding. The index of a value represents the encoded</span>
<span class="sd">        value.</span>
<span class="sd">    cat_feature_names</span>
<span class="sd">        Names of categorical features.</span>
<span class="sd">    cont_feature_names</span>
<span class="sd">        Names of continuous features.</span>
<span class="sd">    data_path</span>
<span class="sd">        The path to the data file.</span>
<span class="sd">    dataderivers</span>
<span class="sd">        A list of :class:`tabensemb.data.AbstractDeriver`.</span>
<span class="sd">    dataimputer</span>
<span class="sd">        A :class:`tabensemb.data.AbstractImputer`.</span>
<span class="sd">    dataprocessors</span>
<span class="sd">        A list of :class:`tabensemb.data.AbstractProcessor`.</span>
<span class="sd">    datasplitter</span>
<span class="sd">        A :class:`tabensemb.data.AbstractSplitter`.</span>
<span class="sd">    derived_data</span>
<span class="sd">        The derived unstacked data calculated using :attr:`dataderivers` whose argument &quot;stacked&quot; is set to False.</span>
<span class="sd">    df</span>
<span class="sd">        The unscaled processed dataset. It is already ordinal-encoded if a</span>
<span class="sd">        :class:`tabensemb.data.dataprocessor.CategoricalOrdinalEncoder` is used.</span>
<span class="sd">    dropped_indices</span>
<span class="sd">        Indices of data points that are removed from the original dataset.</span>
<span class="sd">    label_name</span>
<span class="sd">        The name(s) of target(s)</span>
<span class="sd">    label_ordinal_encoder</span>
<span class="sd">        A ``sklearn.preprocessing.OrdinalEncoder`` that encodes the classification targets.</span>
<span class="sd">    loss</span>
<span class="sd">        The type of the loss function. See :meth:`_infer_loss`.</span>
<span class="sd">    n_classes</span>
<span class="sd">        The number of unique values for each classification target.</span>
<span class="sd">    retained_indices</span>
<span class="sd">        Indices of data points that are retained in the original dataset.</span>
<span class="sd">    scaled_df</span>
<span class="sd">        The scaled processed dataset. See also :attr:`df`.</span>
<span class="sd">    task</span>
<span class="sd">        The type of the task. See :meth:`_infer_task`.</span>
<span class="sd">    tensors</span>
<span class="sd">        :meth:`feature_data`, expanded :attr:`derived_data`, and :meth:`label_data` in the torch.Tensor form.</span>
<span class="sd">    test_dataset</span>
<span class="sd">        The testing set of the entire ``torch.utils.data.Dataset``.</span>
<span class="sd">    test_indices</span>
<span class="sd">        Indices of the testing set in the entire dataset (:attr:`df`).</span>
<span class="sd">    train_dataset</span>
<span class="sd">        The training set of the entire ``torch.utils.data.Dataset``.</span>
<span class="sd">    train_indices</span>
<span class="sd">        Indices of the training set in the entire dataset (:attr:`df`).</span>
<span class="sd">    training</span>
<span class="sd">        The training status of the :class:`DataModule`. See :meth:`set_status`.</span>
<span class="sd">    unstacked_col_names</span>
<span class="sd">        Names of columns of each derived unstacked feature.</span>
<span class="sd">    val_dataset</span>
<span class="sd">        The validation set of the entire ``torch.utils.data.Dataset``.</span>
<span class="sd">    val_indices</span>
<span class="sd">        Indices of the validation set in the entire dataset (:attr:`df`).</span>
<span class="sd">    D_test</span>
<span class="sd">    D_train</span>
<span class="sd">    D_val</span>
<span class="sd">    X_test</span>
<span class="sd">    X_train</span>
<span class="sd">    X_val</span>
<span class="sd">    all_feature_names</span>
<span class="sd">    cat_imputed_mask</span>
<span class="sd">    cat_num_unique</span>
<span class="sd">    categorical_data</span>
<span class="sd">    cont_imputed_mask</span>
<span class="sd">    derived_stacked_features</span>
<span class="sd">    feature_data</span>
<span class="sd">    label_data</span>
<span class="sd">    unscaled_feature_data</span>
<span class="sd">    unscaled_label_data</span>
<span class="sd">    y_test</span>
<span class="sd">    y_train</span>
<span class="sd">    y_val</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DataModule.__init__">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.html#tabensemb.data.datamodule.DataModule.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">UserConfig</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span>
        <span class="n">initialize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">config</span>
        <span class="k">if</span> <span class="n">initialize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data_splitter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;data_splitter&quot;</span><span class="p">],</span> <span class="n">ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;split_ratio&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data_imputer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;data_imputer&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data_processors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;data_processors&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data_derivers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;data_derivers&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="DataModule.set_status">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.set_status.html#tabensemb.data.datamodule.DataModule.set_status">[docs]</a>
    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the status of the datamodule. If a datamodule is not training, some data processing modules will use learned</span>
<span class="sd">        characteristics to process new data. True when setting the dataset. False when processing an upcoming dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        training</span>
<span class="sd">            The training status of the datamodule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="n">training</span></div>


<div class="viewcode-block" id="DataModule.set_data_splitter">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.set_data_splitter.html#tabensemb.data.datamodule.DataModule.set_data_splitter">[docs]</a>
    <span class="k">def</span> <span class="nf">set_data_splitter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]],</span>
        <span class="n">ratio</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the data splitter. The specified splitter should be registered in</span>
<span class="sd">        ``tabensemb.data.datasplitter.splitter_mapping``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config</span>
<span class="sd">            The name of a data splitter or a tuple providing the name and kwargs of the data splitter.</span>
<span class="sd">        ratio</span>
<span class="sd">            The ratio of training, validation, and testing sets. For example, [0.6, 0.2, 0.2].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">tabensemb.data.datasplitter</span> <span class="kn">import</span> <span class="n">get_data_splitter</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datasplitter</span> <span class="o">=</span> <span class="n">get_data_splitter</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ratio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">datasplitter</span> <span class="o">=</span> <span class="n">get_data_splitter</span><span class="p">(</span><span class="n">config</span><span class="p">)()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">datasplitter</span> <span class="o">=</span> <span class="n">get_data_splitter</span><span class="p">(</span><span class="n">config</span><span class="p">)(</span><span class="n">train_val_test</span><span class="o">=</span><span class="n">ratio</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.set_data_imputer">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.set_data_imputer.html#tabensemb.data.datamodule.DataModule.set_data_imputer">[docs]</a>
    <span class="k">def</span> <span class="nf">set_data_imputer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the data imputer. The specified splitter should be registered in</span>
<span class="sd">        ``tabensemb.data.dataimputer.imputer_mapping``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config</span>
<span class="sd">            The name of a data imputer or a tuple providing the name and kwargs of the data imputer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">tabensemb.data.dataimputer</span> <span class="kn">import</span> <span class="n">get_data_imputer</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataimputer</span> <span class="o">=</span> <span class="n">get_data_imputer</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataimputer</span> <span class="o">=</span> <span class="n">get_data_imputer</span><span class="p">(</span><span class="n">config</span><span class="p">)()</span></div>


<div class="viewcode-block" id="DataModule.set_data_processors">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.set_data_processors.html#tabensemb.data.datamodule.DataModule.set_data_processors">[docs]</a>
    <span class="k">def</span> <span class="nf">set_data_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a list of data processors containing the name and arguments for each data processor. The processor should be</span>
<span class="sd">        registered in ``tabensemb.data.dataprocessor.processor_mapping``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config</span>
<span class="sd">            A list of tuples. Each tuple includes the name of the processor and a dict of kwargs for the processor.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Only one :class:`~tabensemb.data.base.AbstractScaler` can be used, and the</span>
<span class="sd">        :class:`~tabensemb.data.base.AbstractScaler` must be the last one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">tabensemb.data.dataprocessor</span> <span class="kn">import</span> <span class="n">get_data_processor</span><span class="p">,</span> <span class="n">AbstractScaler</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataprocessors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">get_data_processor</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">config</span>
        <span class="p">]</span>
        <span class="n">is_scaler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">AbstractScaler</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataprocessors</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">is_scaler</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;More than one AbstractScaler.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_scaler</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The last dataprocessor should be an AbstractScaler.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.set_data_derivers">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.set_data_derivers.html#tabensemb.data.datamodule.DataModule.set_data_derivers">[docs]</a>
    <span class="k">def</span> <span class="nf">set_data_derivers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a list of data derivers containing the name and arguments for each data deriver. The deriver should be</span>
<span class="sd">        registered in ``tabensemb.data.dataderiver.deriver_mapping``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config</span>
<span class="sd">            A list of tuple. Each tuple includes the name of the deriver and a dict of kwargs for the deriver.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">tabensemb.data.dataderiver</span> <span class="kn">import</span> <span class="n">get_data_deriver</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataderivers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">get_data_deriver</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">config</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unstacked_col_names</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="DataModule.load_data">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.load_data.html#tabensemb.data.datamodule.DataModule.load_data">[docs]</a>
    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load tabular data. Either a .csv or .xlsx file is supported.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_path</span>
<span class="sd">            Path to the tabular data. By default, the file</span>
<span class="sd">            ``tabensemb.setting[&quot;default_data_path&quot;]/{database}.csv(.xlsx)`` is loaded where &quot;database&quot; is given in the</span>
<span class="sd">            configuration.</span>
<span class="sd">        save_path</span>
<span class="sd">            Path to save the loaded data.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Arguments for ``pd.read_excel`` or ``pd.read_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;database&quot;</span><span class="p">]</span>
                <span class="n">data_path</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">path</span>
                    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tabensemb</span><span class="o">.</span><span class="n">setting</span><span class="p">[</span><span class="s2">&quot;default_data_path&quot;</span><span class="p">],</span> <span class="n">path</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using previously used data path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span>
        <span class="n">file_type</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">data_path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">is_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
            <span class="n">is_xlsx</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_csv</span> <span class="ow">and</span> <span class="n">is_xlsx</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Both </span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s2">.csv and </span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s2">.xlsx exist. Provide the postfix in data_path.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_csv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_xlsx</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s2">.csv and .xlsx do not exist.&quot;</span><span class="p">)</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;.csv&quot;</span> <span class="k">if</span> <span class="n">is_csv</span> <span class="k">else</span> <span class="s2">&quot;.xlsx&quot;</span>
            <span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="n">file_type</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;openpyxl&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span>

        <span class="n">cont_feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;continuous_feature_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># The order of categorical features affect all results.</span>
        <span class="n">cat_feature_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;categorical_feature_names&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">label_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;label_name&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">cat_feature_names</span><span class="p">,</span> <span class="n">label_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Dataset size:&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_dataset</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.set_data">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.set_data.html#tabensemb.data.datamodule.DataModule.set_data">[docs]</a>
    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">cont_feature_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">cat_feature_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">label_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">derived_stacked_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">derived_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">warm_start</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">all_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">train_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up the datamodule with a DataFrame. Data splitting, imputation, derivation, and processing will be performed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df</span>
<span class="sd">            The tabular dataset. Note that if a ``DataModule.df`` is passed here, it should be inverse-transformed</span>
<span class="sd">            first using :meth:`categories_inverse_transform`.</span>
<span class="sd">        cont_feature_names</span>
<span class="sd">            A list of continuous features in the tabular dataset.</span>
<span class="sd">        cat_feature_names</span>
<span class="sd">            A list of categorical features in the tabular dataset.</span>
<span class="sd">        label_name</span>
<span class="sd">            A list of targets. Multi target tasks are experimental.</span>
<span class="sd">        derived_stacked_features</span>
<span class="sd">            A list of derived features in the tabular dataset. If not None, only these features are retained after</span>
<span class="sd">            derivation, and all AbstractFeatureSelectors will be skipped.</span>
<span class="sd">        derived_data</span>
<span class="sd">            The derived data calculated using data derivers whose argument &quot;stacked&quot; is set to False, i.e. unstacked</span>
<span class="sd">            data. Unstacked derivations will be skipped if it is given.</span>
<span class="sd">        warm_start</span>
<span class="sd">            Whether to use fitted data processors to process the data.</span>
<span class="sd">        verbose</span>
<span class="sd">            Verbosity.</span>
<span class="sd">        all_training</span>
<span class="sd">            Whether all samples are used for training.</span>
<span class="sd">        train_indices</span>
<span class="sd">            Manually specify the training indices.</span>
<span class="sd">        val_indices</span>
<span class="sd">            Manually specify the validation indices.</span>
<span class="sd">        test_indices</span>
<span class="sd">            Manually specify the testing indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Multi-target task is currently experimental. Some model base does not support multi-target&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;well, pytorch-widedeep for example.&quot;</span>
            <span class="p">)</span>

        <span class="n">detected_cat_feature_names</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="nb">object</span><span class="p">]</span>
        <span class="n">illegal_cont_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">detected_cat_feature_names</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">illegal_cont_features</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">illegal_cont_features</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">illegal_cont_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">illegal_cont_features</span><span class="si">}</span><span class="s2"> are object, but are included in continuous features. Please remove them &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;or add them to `categorical_feature_names` in the configuration file.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="o">=</span> <span class="n">cont_feature_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span> <span class="o">=</span> <span class="n">cat_feature_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span> <span class="o">=</span> <span class="n">label_name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Call df.reset_index(drop=True) to reset the index of the dataset.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Label missing in the input dataframe.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">all_training</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">train_indices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">val_indices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">test_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasplitter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">cat_feature_names</span><span class="p">,</span> <span class="n">label_name</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span> <span class="o">=</span> <span class="n">train_indices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span> <span class="o">=</span> <span class="n">val_indices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span> <span class="o">=</span> <span class="n">test_indices</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cont_imputed_mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unscaled_feature_data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cat_imputed_mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">make_imputation</span><span class="p">():</span>
            <span class="n">train_val_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_val_indices</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataimputer</span><span class="p">,</span> <span class="s2">&quot;fit_transform&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">warm_start</span> <span class="k">else</span> <span class="s2">&quot;transform&quot;</span>
            <span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_val_indices</span><span class="p">,</span> <span class="p">:],</span> <span class="n">datamodule</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">,</span> <span class="p">:],</span> <span class="n">datamodule</span><span class="o">=</span><span class="bp">self</span>
            <span class="p">)</span>

        <span class="n">make_imputation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">cat_feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derive_stacked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">derived_stacked_features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">current_derived_stacked_cont_features</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extract_derived_stacked_feature_names</span><span class="p">(</span><span class="n">cont_feature_names</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">removed_cont</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
                    <span class="n">current_derived_stacked_cont_features</span><span class="p">,</span> <span class="n">derived_stacked_features</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">cont_feature_names</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cont_feature_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">removed_cont</span>
            <span class="p">]</span>
            <span class="n">current_derived_stacked_cat_features</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extract_derived_stacked_feature_names</span><span class="p">(</span><span class="n">cat_feature_names</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">removed_cat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
                    <span class="n">current_derived_stacked_cat_features</span><span class="p">,</span> <span class="n">derived_stacked_features</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">cat_feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_feature_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">removed_cat</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="o">=</span> <span class="n">cont_feature_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span> <span class="o">=</span> <span class="n">cat_feature_names</span>
        <span class="c1"># There may exist nan in stacked features.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cont_imputed_mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cont_imputed_mask</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_stacked_cont_features</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cat_imputed_mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cat_imputed_mask</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_stacked_cat_features</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="p">],</span>  <span class="c1"># How to find invalid values in object columns (after they are turned into &quot;nan&quot;)?</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span>
        <span class="n">make_imputation</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_process</span><span class="p">(</span>
            <span class="n">warm_start</span><span class="o">=</span><span class="n">warm_start</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">skip_selector</span><span class="o">=</span><span class="n">derived_stacked_features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cont_imputed_mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cont_imputed_mask</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">retained_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">]</span>
            <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cat_imputed_mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cat_imputed_mask</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">retained_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span>
            <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">update_indices</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropped_indices</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">retained_indices</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span> <span class="o">=</span> <span class="n">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span> <span class="o">=</span> <span class="n">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span> <span class="o">=</span> <span class="n">update_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">augmented_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">augmented_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">augmented_indices</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropped_indices</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">augmented_indices</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">augmented_indices</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;No sufficient data after preprocessing. This is caused by arguments train/val/test_&quot;</span>
                <span class="s2">&quot;indices or warm_start of set_data().&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derive_unstacked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">derived_data</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_derived_data</span><span class="p">(</span><span class="n">derived_data</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_task</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_loss</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="s2">&quot;multiclass&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_data</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_ordinal_encoder</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">()</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_ordinal_encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_data</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_data</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaled_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_ordinal_encoder</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_dataset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cat_num_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of unique values of each categorical feature. Only valid when a</span>
<span class="sd">        :class:`~tabensemb.data.dataprocessor.CategoricalOrdinalEncoder` is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cat_feature_mapping&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">[]</span>
        <span class="p">)</span>

<div class="viewcode-block" id="DataModule._infer_task">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule._infer_task.html#tabensemb.data.datamodule.DataModule._infer_task">[docs]</a>
    <span class="k">def</span> <span class="nf">_infer_task</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Automatically infer the task type using the target values. If the inferred type is not the same as that set</span>
<span class="sd">        in the configuration, the inferred type is used if the global setting</span>
<span class="sd">        ``tabensemb.setting[&quot;raise_inconsistent_inferred_task&quot;]`` is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            &quot;binary&quot;, &quot;multiclass&quot;, or &quot;regression&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;task&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;task&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="c1"># if isinstance(selected_task, dict):</span>
        <span class="c1">#     return selected_task</span>
        <span class="k">if</span> <span class="n">selected_task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selected_task</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple tasks is not supported.&quot;</span><span class="p">)</span>
        <span class="n">available_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="s2">&quot;multiclass&quot;</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">infer_one_col</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span><span class="p">:</span>
                <span class="n">is_cat</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">is_cat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized target type </span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_cat</span><span class="p">:</span>
                <span class="n">n_unique</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">n_unique</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">infer_task</span> <span class="o">=</span> <span class="s2">&quot;binary&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">infer_task</span> <span class="o">=</span> <span class="s2">&quot;multiclass&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">infer_task</span> <span class="o">=</span> <span class="s2">&quot;regression&quot;</span>
            <span class="k">if</span> <span class="n">task</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">infer_task</span>
            <span class="k">elif</span> <span class="n">task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">task</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_tasks</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported task </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">infer_task</span> <span class="o">!=</span> <span class="n">task</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tabensemb</span><span class="o">.</span><span class="n">setting</span><span class="p">[</span><span class="s2">&quot;raise_inconsistent_inferred_task&quot;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The inferred task </span><span class="si">{</span><span class="n">infer_task</span><span class="si">}</span><span class="s2"> is not consistent with the selected task </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The inferred task </span><span class="si">{</span><span class="n">infer_task</span><span class="si">}</span><span class="s2"> is not consistent with the selected task </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">. Using the &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;selected task.&quot;</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">infer_task</span> <span class="o">==</span> <span class="s2">&quot;regression&quot;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;The inferred task is regression because the targets are not integers, but the selected &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;task is </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">, which will make categorical ordinal encoder unhappy.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="n">task</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">task</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">infer_one_col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_data</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">selected_task</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="s2">&quot;multiclass&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">task</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multi-target classification task is not supported.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;regression&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">infer_one_col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_data</span><span class="p">,</span> <span class="n">selected_task</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task</span></div>


<div class="viewcode-block" id="DataModule._infer_loss">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule._infer_loss.html#tabensemb.data.datamodule.DataModule._infer_loss">[docs]</a>
    <span class="k">def</span> <span class="nf">_infer_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Automatically infer the loss type using the name of the task and the loss type given in the configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        task</span>
<span class="sd">            &quot;binary&quot;, &quot;multiclass&quot;, or &quot;regression&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            &quot;mse&quot; or &quot;mae&quot; for regression tasks and &quot;cross_entropy&quot; for classification tasks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;loss&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="c1"># if isinstance(selected_loss, dict):</span>
        <span class="c1">#     return selected_loss</span>
        <span class="k">if</span> <span class="n">selected_loss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selected_loss</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple losses is not supported.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">task</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="s2">&quot;multiclass&quot;</span><span class="p">]:</span>
            <span class="n">available_losses</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cross_entropy&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">available_losses</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mse&quot;</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">selected_loss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">available_losses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">selected_loss</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_losses</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The selected loss </span><span class="si">{</span><span class="n">selected_loss</span><span class="si">}</span><span class="s2"> is not supported for </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> tasks&quot;</span>
                <span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">selected_loss</span>
        <span class="k">return</span> <span class="n">loss</span></div>


<div class="viewcode-block" id="DataModule.prepare_new_data">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.prepare_new_data.html#tabensemb.data.datamodule.DataModule.prepare_new_data">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_new_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">derived_data</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_absence</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the new tabular dataset for predictions using :meth:`~tabensemb.model.AbstractModel._predict`</span>
<span class="sd">        Stacked and unstacked features are derived; missing values are imputed; The ``transform`` method of</span>
<span class="sd">        :class:`~tabensemb.data.base.AbstractProcessor` is called. Users usually do not need to</span>
<span class="sd">        call this because :meth:`~tabensemb.model.AbstractModel.predict` does it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df:</span>
<span class="sd">            A new tabular dataset.</span>
<span class="sd">        derived_data:</span>
<span class="sd">            Data derived from :meth:`.derive_unstacked`. If not None, unstacked data will be re-derived.</span>
<span class="sd">        ignore_absence:</span>
<span class="sd">            Whether to ignore absent keys in derived_data. Use True only when the model does not use derived_data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df</span>
<span class="sd">            The dataset after derivation, imputation, and processing. It has the same structure as ``self.X_train``</span>
<span class="sd">        derived_data:</span>
<span class="sd">            Data derived from :meth:`.derive_unstacked`. It has the same structure as ``self.D_train``</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The returned ``df`` is not scaled for the sake of further treatments. To scale the df,</span>
<span class="sd">        run ``df = datamodule.data_transform(df, scaler_only=True)``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">absent_features</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_stacked_features</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">]</span>
        <span class="n">absent_derived_features</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_stacked_features</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">absent_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">absent_features</span><span class="si">}</span><span class="s2"> not in the input dataframe.&quot;</span><span class="p">)</span>

        <span class="c1"># Predicting on a dataset whose categorical features are already encoded. It may interrupt</span>
        <span class="c1"># data derivers that rely on categorical features, or get inconsistent results between</span>
        <span class="c1"># _predict and predict.</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;augmented&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">derived_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="s2">&quot;augmented&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">derived_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">derived_data</span><span class="p">[</span><span class="s2">&quot;augmented&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">derived_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">absent_derived_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">derived_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">absent_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">key</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">derived_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">absent_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_absence</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Additional feature </span><span class="si">{</span><span class="n">absent_keys</span><span class="si">}</span><span class="s2"> not in the input derived_data.&quot;</span>
                <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_transform</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">skip_scaler</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">derived_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_derived_data</span><span class="p">(</span>
            <span class="n">derived_data</span><span class="p">,</span> <span class="n">ignore_absence</span><span class="o">=</span><span class="n">ignore_absence</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;label_ordinal_encoder&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_categories_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">derived_data</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cont_imputed_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A byte mask for continuous data, where 1 means the data is imputed, and 0 means the data originally exists.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            A byte mask dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cont_imputed_mask</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cat_imputed_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A byte mask for categorical data, where 1 means the data is imputed, and 0 means the data originally exists.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            A byte mask dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cat_imputed_mask</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get continuous feature names and categorical feature names after ``load_data()``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            A list of continuous features and categorical features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">derived_stacked_features</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find derived features in :attr:`all_feature_names` derived by data derivers whose argument &quot;stacked&quot; is set to</span>
<span class="sd">        True, i.e. the stacked data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            A list of feature names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_derived_stacked_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">derived_stacked_cont_features</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find derived features in :attr:`cont_feature_names` derived by data derivers whose argument &quot;stacked&quot; is set to</span>
<span class="sd">        True, i.e. the stacked data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            A list of feature names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_derived_stacked_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">derived_stacked_cat_features</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find derived features in :attr:`cat_feature_names` derived by data derivers whose argument &quot;stacked&quot; is set to</span>
<span class="sd">        True, i.e. the stacked data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            A list of feature names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_derived_stacked_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">)</span>

<div class="viewcode-block" id="DataModule.get_feature_types">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_feature_types.html#tabensemb.data.datamodule.DataModule.get_feature_types">[docs]</a>
    <span class="k">def</span> <span class="nf">get_feature_types</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">allow_unknown</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the type defined in ``feature_types`` in the configuration for each feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features</span>
<span class="sd">            A list of features.</span>
<span class="sd">        allow_unknown</span>
<span class="sd">            Regard unknown features as &quot;Unknown&quot; features. If False, an error will be raised if unknown features are</span>
<span class="sd">            found.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The type of each feature</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`get_feature_types_idx`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_types_with_derived</span><span class="p">()</span>
        <span class="n">invalid_features</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">feature_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_unknown</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown features: </span><span class="si">{</span><span class="n">invalid_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">feature_types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="DataModule.feature_types_with_derived">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.feature_types_with_derived.html#tabensemb.data.datamodule.DataModule.feature_types_with_derived">[docs]</a>
    <span class="k">def</span> <span class="nf">feature_types_with_derived</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A dictionary stating the category of each feature, including derived stacked features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">derived_stacked_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_derived_stacked_feature_names</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span>
        <span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_types&quot;</span><span class="p">])</span>
        <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">feature</span><span class="p">:</span> <span class="s2">&quot;Derived&quot;</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">derived_stacked_features</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">d</span></div>


<div class="viewcode-block" id="DataModule.unique_feature_types_with_derived">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.unique_feature_types_with_derived.html#tabensemb.data.datamodule.DataModule.unique_feature_types_with_derived">[docs]</a>
    <span class="k">def</span> <span class="nf">unique_feature_types_with_derived</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unique values in :meth:`feature_types_with_derived`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_types_with_derived</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span></div>


<div class="viewcode-block" id="DataModule.get_feature_types_idx">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_feature_types_idx.html#tabensemb.data.datamodule.DataModule.get_feature_types_idx">[docs]</a>
    <span class="k">def</span> <span class="nf">get_feature_types_idx</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">allow_unknown</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each feature, get the index in ``unique_feature_types`` of its type defined in ``feature_types`` in the</span>
<span class="sd">        configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features</span>
<span class="sd">            A list of features.</span>
<span class="sd">        allow_unknown</span>
<span class="sd">            Regard unknown features as &quot;Unknown&quot; features (whose index is the number of known feature types). If False,</span>
<span class="sd">            an error will be raised if unknown features are found.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The index of the type for each feature</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`get_feature_types`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_types</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">allow_unknown</span><span class="o">=</span><span class="n">allow_unknown</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unique_feature_types_with_derived</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;Unknown&quot;</span>
                <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_feature_types_with_derived</span><span class="p">())</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">types</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="DataModule.get_feature_names_by_type">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_feature_names_by_type.html#tabensemb.data.datamodule.DataModule.get_feature_names_by_type">[docs]</a>
    <span class="k">def</span> <span class="nf">get_feature_names_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find features of the specified type defined by ``feature_types`` in the configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typ</span>
<span class="sd">            One type of features defined in ``unique_feature_types`` in the configuration.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            A list of found features.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`get_feature_idx_by_type`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The key &quot;Unknown&quot; returned by :meth:`get_feature_types` is not a real key defined in ``unique_feature_types``.</span>
<span class="sd">        It is a reserved type representing unknown features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_feature_types_with_derived</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Feature type </span><span class="si">{</span><span class="n">typ</span><span class="si">}</span><span class="s2"> is invalid (among </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;unique_feature_types&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">feature</span>
            <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_types_with_derived</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">typ</span> <span class="ow">and</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="DataModule.get_feature_idx_by_type">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_feature_idx_by_type.html#tabensemb.data.datamodule.DataModule.get_feature_idx_by_type">[docs]</a>
    <span class="k">def</span> <span class="nf">get_feature_idx_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">var_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find features (by their index) of the specified type defined by ``feature_types`` in the configuration. This is</span>
<span class="sd">        used to determine the indices of specific features after they are transformed into ``torch.Tensor``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typ</span>
<span class="sd">            One type of features in ``unique_feature_types`` in the configuration.</span>
<span class="sd">        var_type</span>
<span class="sd">            &quot;continuous&quot;, &quot;categorical&quot;, or &quot;any&quot;. If is &quot;continuous&quot;, only indices of :attr:`cont_feature_names` of</span>
<span class="sd">            continuous features will be returned. If is &quot;categorical&quot;, indices of :attr:`cat_feature_names` of</span>
<span class="sd">            categorical features will be returned. If is &quot;any&quot;, indices of :attr:`all_feature_names` will be returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            A list of indices of found features.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`get_feature_names_by_type`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_names_by_type</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="n">typ</span><span class="p">)</span>
        <span class="n">name_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;categorical&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">,</span>
            <span class="s2">&quot;continuous&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">,</span>
            <span class="s2">&quot;any&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">,</span>
        <span class="p">}[</span><span class="n">var_type</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">name_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">])</span></div>


<div class="viewcode-block" id="DataModule.extract_original_cont_feature_names">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.extract_original_cont_feature_names.html#tabensemb.data.datamodule.DataModule.extract_original_cont_feature_names">[docs]</a>
    <span class="k">def</span> <span class="nf">extract_original_cont_feature_names</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">all_feature_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get original continuous features specified in the configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        all_feature_names</span>
<span class="sd">            A list of features that contains some original features in the configuration.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            Names of continuous original features both in the configuration and the input list.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`extract_original_cat_feature_names`, :meth:`extract_derived_stacked_feature_names`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_feature_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;continuous_feature_names&quot;</span><span class="p">]</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="DataModule.extract_original_cat_feature_names">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.extract_original_cat_feature_names.html#tabensemb.data.datamodule.DataModule.extract_original_cat_feature_names">[docs]</a>
    <span class="k">def</span> <span class="nf">extract_original_cat_feature_names</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">all_feature_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get original categorical features specified in the configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        all_feature_names</span>
<span class="sd">            A list of features that contains some original features in the configuration.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            Names of categorical original features that are both in the configuration and the input list.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`extract_original_cont_feature_names`, :meth:`extract_derived_stacked_feature_names`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_feature_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;categorical_feature_names&quot;</span><span class="p">]</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="DataModule.extract_derived_stacked_feature_names">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.extract_derived_stacked_feature_names.html#tabensemb.data.datamodule.DataModule.extract_derived_stacked_feature_names">[docs]</a>
    <span class="k">def</span> <span class="nf">extract_derived_stacked_feature_names</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">all_feature_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find derived features in the input list derived by data derivers whose argument &quot;stacked&quot; is set to True,</span>
<span class="sd">        i.e. the stacked data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        all_feature_names</span>
<span class="sd">            A list of features that contains some stacked features.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            Names of stacked features in the input list.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`extract_original_cont_feature_names`, :meth:`extract_original_cat_feature_names`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_feature_names</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_derived_stacked_feature_names</span><span class="p">()</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="DataModule.get_all_derived_stacked_feature_names">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_all_derived_stacked_feature_names.html#tabensemb.data.datamodule.DataModule.get_all_derived_stacked_feature_names">[docs]</a>
    <span class="k">def</span> <span class="nf">get_all_derived_stacked_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all derived stacked features (not intermediate) from arguments of :attr:`dataderivers`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            Names of all derived stacked from the current data derivers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">deriver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataderivers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deriver</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;stacked&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">deriver</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;intermediate&quot;</span><span class="p">]:</span>
                <span class="n">names</span> <span class="o">+=</span> <span class="n">deriver</span><span class="o">.</span><span class="n">last_derived_col_names</span>
        <span class="k">return</span> <span class="n">names</span></div>


<div class="viewcode-block" id="DataModule.get_all_derived_unstacked_feature_names">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_all_derived_unstacked_feature_names.html#tabensemb.data.datamodule.DataModule.get_all_derived_unstacked_feature_names">[docs]</a>
    <span class="k">def</span> <span class="nf">get_all_derived_unstacked_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all derived unstacked features from :attr:`unstacked_col_names`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            Names of all derived unstacked from the current data derivers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unstacked_col_names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">names</span> <span class="o">+=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">names</span></div>


<div class="viewcode-block" id="DataModule.set_feature_names">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.set_feature_names.html#tabensemb.data.datamodule.DataModule.set_feature_names">[docs]</a>
    <span class="k">def</span> <span class="nf">set_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_feature_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set feature names to a subset of current features (i.e. ``self.all_feature_names``) and reload the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        all_feature_names</span>
<span class="sd">            A subset of current features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cont_feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_original_cont_feature_names</span><span class="p">(</span><span class="n">all_feature_names</span><span class="p">)</span>
        <span class="n">cat_feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_original_cat_feature_names</span><span class="p">(</span><span class="n">all_feature_names</span><span class="p">)</span>
        <span class="n">derived_stacked_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_derived_stacked_feature_names</span><span class="p">(</span>
            <span class="n">all_feature_names</span>
        <span class="p">)</span>
        <span class="n">has_indices</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;train_indices&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">),</span>
            <span class="n">cont_feature_names</span><span class="p">,</span>
            <span class="n">cat_feature_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">,</span>
            <span class="n">derived_stacked_features</span><span class="o">=</span><span class="n">derived_stacked_features</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">train_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span> <span class="k">if</span> <span class="n">has_indices</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">val_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span> <span class="k">if</span> <span class="n">has_indices</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">test_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span> <span class="k">if</span> <span class="n">has_indices</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.sort_derived_data">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.sort_derived_data.html#tabensemb.data.datamodule.DataModule.sort_derived_data">[docs]</a>
    <span class="k">def</span> <span class="nf">sort_derived_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">derived_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">ignore_absence</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort the dict of derived unstacked data according to the order of derivation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        derived_data</span>
<span class="sd">            A dict of derived unstacked data calculated by :meth:`derive_unstacked`</span>
<span class="sd">        ignore_absence</span>
<span class="sd">            Whether to ignore absent keys in derived_data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict or None</span>
<span class="sd">            The sorted derived unstacked data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">derived_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp_derived_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ignore_absence</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">derived_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">tmp_derived_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">derived_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp_derived_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">derived_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">tmp_derived_data</span></div>


<div class="viewcode-block" id="DataModule.get_categorical_ordinal_encoder">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_categorical_ordinal_encoder.html#tabensemb.data.datamodule.DataModule.get_categorical_ordinal_encoder">[docs]</a>
    <span class="k">def</span> <span class="nf">get_categorical_ordinal_encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find and return the :class:`~tabensemb.data.utils.OrdinalEncoder` in data processors..</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CategoricalOrdinalEncoder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">tabensemb.data.dataprocessor</span> <span class="kn">import</span> <span class="n">CategoricalOrdinalEncoder</span>

        <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataprocessors</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">CategoricalOrdinalEncoder</span><span class="p">):</span>
                <span class="n">transformer</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">transformer</span>
                <span class="k">return</span> <span class="n">transformer</span> <span class="k">if</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fitted</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="DataModule.categories_inverse_transform">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.categories_inverse_transform.html#tabensemb.data.datamodule.DataModule.categories_inverse_transform">[docs]</a>
    <span class="k">def</span> <span class="nf">categories_inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inverse transformation of :class:`~tabensemb.data.dataprocessor.CategoricalOrdinalEncoder` for categorical</span>
<span class="sd">        features (If there is one in ``self.dataprocessors``).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X</span>
<span class="sd">            The data to be inverse-transformed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The inverse-transformed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_categorical_ordinal_encoder</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">encoder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">encoder</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.categories_transform">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.categories_transform.html#tabensemb.data.datamodule.DataModule.categories_transform">[docs]</a>
    <span class="k">def</span> <span class="nf">categories_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transformation of :class:`~tabensemb.data.dataprocessor.CategoricalOrdinalEncoder` for categorical features</span>
<span class="sd">        (If there is one in ``self.dataprocessors``).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X</span>
<span class="sd">            The data to be transformed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The transformed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_categorical_ordinal_encoder</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">encoder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.label_categories_transform">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.label_categories_transform.html#tabensemb.data.datamodule.DataModule.label_categories_transform">[docs]</a>
    <span class="k">def</span> <span class="nf">label_categories_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Categorical ordinal encoding for the target.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X</span>
<span class="sd">            The data to be transformed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The transformed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_ordinal_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.label_categories_inverse_transform">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.label_categories_inverse_transform.html#tabensemb.data.datamodule.DataModule.label_categories_inverse_transform">[docs]</a>
    <span class="k">def</span> <span class="nf">label_categories_inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inverse transformation of categorical ordinal encoding for the target.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X</span>
<span class="sd">            The data to be transformed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The transformed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_ordinal_encoder</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.save_data">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.save_data.html#tabensemb.data.datamodule.DataModule.save_data">[docs]</a>
    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the tabular data processed by :meth:`set_data`. Two files will be saved: ``data.csv`` contains all</span>
<span class="sd">        information from the input dataframe, and ``tabular_data.csv`` contains merely used features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path</span>
<span class="sd">            The path to save the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;data.csv&quot;</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">tabular_data</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">cat_feature_names</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tabular_dataset</span><span class="p">()</span>
        <span class="n">tabular_data_inv</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_feature_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="n">tabular_data</span>
        <span class="p">)</span>
        <span class="n">tabular_data_inv</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;tabular_data.csv&quot;</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data saved to </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> (data.csv and tabular_data.csv).&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.derive">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.derive.html#tabensemb.data.datamodule.DataModule.derive">[docs]</a>
    <span class="k">def</span> <span class="nf">derive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derive both stacked and unstacked features using the input dataframe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df</span>
<span class="sd">            The tabular dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The tabular dataset with derived stacked features.</span>
<span class="sd">        List</span>
<span class="sd">            Continuous feature names with derived stacked features.</span>
<span class="sd">        List</span>
<span class="sd">            Categorical feature names with derived stacked features.</span>
<span class="sd">        dict</span>
<span class="sd">            The derived unstacked data.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`.derive_stacked`, :meth:`.derive_unstacked`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_tmp</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">cat_feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derive_stacked</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">derived_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derive_unstacked</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_tmp</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">cat_feature_names</span><span class="p">,</span> <span class="n">derived_data</span></div>


<div class="viewcode-block" id="DataModule.derive_stacked">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.derive_stacked.html#tabensemb.data.datamodule.DataModule.derive_stacked">[docs]</a>
    <span class="k">def</span> <span class="nf">derive_stacked</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derive stacked features using the input dataframe. Calculated using data derivers whose argument &quot;stacked&quot; is</span>
<span class="sd">        set to True.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df</span>
<span class="sd">            The tabular dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The tabular dataset with derived stacked features.</span>
<span class="sd">        List</span>
<span class="sd">            Continuous feature names with derived stacked features.</span>
<span class="sd">        List</span>
<span class="sd">            Categorical feature names with derived stacked features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cont_feature_names</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">)</span>
        <span class="n">cat_feature_names</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">deriver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataderivers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deriver</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;stacked&quot;</span><span class="p">]:</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">col_names</span> <span class="o">=</span> <span class="n">deriver</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">deriver</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;intermediate&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">col_names</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">deriver</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;is_continuous&quot;</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cont_feature_names</span>
                        <span class="p">):</span>
                            <span class="n">cont_feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="ow">not</span> <span class="n">deriver</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;is_continuous&quot;</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_feature_names</span>
                        <span class="p">):</span>
                            <span class="n">cat_feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
                <span class="n">df_tmp</span><span class="p">[</span><span class="n">col_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">df_tmp</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">cat_feature_names</span></div>


<div class="viewcode-block" id="DataModule.derive_unstacked">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.derive_unstacked.html#tabensemb.data.datamodule.DataModule.derive_unstacked">[docs]</a>
    <span class="k">def</span> <span class="nf">derive_unstacked</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">categorical_only</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derive unstacked features using the input dataframe. Calculated using data derivers whose argument &quot;stacked&quot; is</span>
<span class="sd">        set to False. Categorical features will be added to the returned dict with the key &quot;categorical&quot;. Indices</span>
<span class="sd">        stating which data points are augmented will be added to the returned dict with the key</span>
<span class="sd">        &quot;augmented&quot; (1 for augmented ones).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df</span>
<span class="sd">            The tabular dataset.</span>
<span class="sd">        categorical_only</span>
<span class="sd">            Whether to only return categorical features.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The derived unstacked data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">derived_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">categorical_only</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">deriver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataderivers</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">deriver</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;stacked&quot;</span><span class="p">]:</span>
                    <span class="n">value</span><span class="p">,</span> <span class="n">col_names</span> <span class="o">=</span> <span class="n">deriver</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">deriver</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;derived_name&quot;</span><span class="p">]</span>
                    <span class="n">derived_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unstacked_col_names</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_names</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">derived_data</span><span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories_transform</span><span class="p">(</span>
                <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unstacked_col_names</span><span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">augmented_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">augmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
                <span class="n">augmented</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">augmented_indices</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropped_indices</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">derived_data</span><span class="p">[</span><span class="s2">&quot;augmented&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">augmented</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unstacked_col_names</span><span class="p">[</span><span class="s2">&quot;augmented&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;augmented&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">derived_data</span></div>


<div class="viewcode-block" id="DataModule._data_process">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule._data_process.html#tabensemb.data.datamodule.DataModule._data_process">[docs]</a>
    <span class="k">def</span> <span class="nf">_data_process</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">warm_start</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_selector</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The main procedure to process data after splitting and imputation. Both scaled and unscaled data will be recorded.</span>
<span class="sd">        Note that processors will fit on training and validation datasets and transform the testing set by calling</span>
<span class="sd">        :meth:`_data_preprocess` with different arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        warm_start</span>
<span class="sd">            Whether to use fitted data processors to process the data.</span>
<span class="sd">        skip_selector</span>
<span class="sd">            True to skip feature selections.</span>
<span class="sd">        verbose</span>
<span class="sd">            Verbosity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_mapping</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">original_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">HiddenPrints</span><span class="p">(</span><span class="n">disable_std</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">df_training</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">),</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_training</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">),</span> <span class="p">:</span>
                <span class="p">]</span>
            <span class="n">unscaled_training_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_preprocess</span><span class="p">(</span>
                <span class="n">df_training</span><span class="p">,</span>
                <span class="n">warm_start</span><span class="o">=</span><span class="n">warm_start</span><span class="p">,</span>
                <span class="n">skip_scaler</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">skip_selector</span><span class="o">=</span><span class="n">skip_selector</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">training_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_preprocess</span><span class="p">(</span>
                <span class="n">unscaled_training_data</span><span class="p">,</span>
                <span class="n">warm_start</span><span class="o">=</span><span class="n">warm_start</span><span class="p">,</span>
                <span class="n">scaler_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">skip_selector</span><span class="o">=</span><span class="n">skip_selector</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">unscaled_testing_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_transform</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">,</span> <span class="p">:],</span> <span class="n">skip_scaler</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">testing_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_transform</span><span class="p">(</span><span class="n">unscaled_testing_data</span><span class="p">,</span> <span class="n">scaler_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">all_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">training_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">testing_data</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retained_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">all_indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">original_length</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropped_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">original_length</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">retained_indices</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">augmented_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
            <span class="n">training_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">original_length</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">testing_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">original_length</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Testing data should not be augmented.&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">process_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">training</span><span class="p">,</span> <span class="n">testing</span><span class="p">):</span>
            <span class="n">inplace_training_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
                <span class="n">training</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">retained_indices</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">training</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inplace_training_index</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">training</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">inplace_training_index</span><span class="p">,</span> <span class="n">col</span>
                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">testing</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">testing</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">testing</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">retained_indices</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">augmented_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">df</span><span class="p">,</span> <span class="n">training</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">augmented_indices</span><span class="p">,</span> <span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">process_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">unscaled_training_data</span><span class="p">,</span> <span class="n">unscaled_testing_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_df</span> <span class="o">=</span> <span class="n">process_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_df</span><span class="p">,</span> <span class="n">training_data</span><span class="p">,</span> <span class="n">testing_data</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unscaled_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unscaled feature data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unscaled_label_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unscaled label data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">categorical_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The categorical data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The scaled feature data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The scaled label data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<div class="viewcode-block" id="DataModule.dataset_dict">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.dataset_dict.html#tabensemb.data.datamodule.DataModule.dataset_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">dataset_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;X_train&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span>
            <span class="s2">&quot;X_val&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_val</span><span class="p">,</span>
            <span class="s2">&quot;X_test&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="p">,</span>
            <span class="s2">&quot;D_train&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">D_train</span><span class="p">,</span>
            <span class="s2">&quot;D_val&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">D_val</span><span class="p">,</span>
            <span class="s2">&quot;D_test&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">D_test</span><span class="p">,</span>
            <span class="s2">&quot;y_train&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span>
            <span class="s2">&quot;y_val&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_val</span><span class="p">,</span>
            <span class="s2">&quot;y_test&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span>
        <span class="p">}</span></div>


    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_dict</span><span class="p">()[</span><span class="n">item</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">X_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unscaled training dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">X_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unscaled validation dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">X_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unscaled testing dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The target of the training dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The target of the validation dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The target of the testing dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">D_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The derived unstacked data of the training dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_derived_data_slice</span><span class="p">(</span>
            <span class="n">derived_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">D_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The derived unstacked data of the validation dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_derived_data_slice</span><span class="p">(</span>
            <span class="n">derived_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">D_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The derived unstacked data of the testing dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_derived_data_slice</span><span class="p">(</span>
            <span class="n">derived_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span>
        <span class="p">)</span>

<div class="viewcode-block" id="DataModule._data_preprocess">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule._data_preprocess.html#tabensemb.data.datamodule.DataModule._data_preprocess">[docs]</a>
    <span class="k">def</span> <span class="nf">_data_preprocess</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">warm_start</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_scaler</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_selector</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">scaler_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call data processors to fit and/or transform the input tabular dataset. It is automatically called by</span>
<span class="sd">        :meth:`_data_process` and :meth:`data_transform` with different arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_data</span>
<span class="sd">            The tabular dataset.</span>
<span class="sd">        warm_start</span>
<span class="sd">            False to fit and transform data processors, and True to transform only.</span>
<span class="sd">        skip_scaler</span>
<span class="sd">            True to skip scaling (the last processor).</span>
<span class="sd">        skip_selector</span>
<span class="sd">            True to skip feature selections.</span>
<span class="sd">        scaler_only</span>
<span class="sd">            True to only perform scaling (the last processor).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The processed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">AbstractScaler</span><span class="p">,</span> <span class="n">AbstractFeatureSelector</span>

        <span class="k">if</span> <span class="n">skip_scaler</span> <span class="ow">and</span> <span class="n">scaler_only</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Both skip_scaler and scaler_only are True.&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataprocessors</span><span class="p">:</span>
            <span class="c1"># First reset the status of the processor.</span>
            <span class="c1"># If scaler_only == True, we may want to fit the scaler separately and do not change the status of others.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scaler_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">warm_start</span><span class="p">:</span>
                <span class="n">processor</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">skip_scaler</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">AbstractScaler</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">skip_selector</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">AbstractFeatureSelector</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">scaler_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">AbstractScaler</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">warm_start</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">processor</span><span class="o">.</span><span class="n">fitted</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="DataModule.data_transform">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.data_transform.html#tabensemb.data.datamodule.DataModule.data_transform">[docs]</a>
    <span class="k">def</span> <span class="nf">data_transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform the input tabular dataset using fitted data processors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_data</span>
<span class="sd">            The tabular dataset.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Other arguments for :meth:`_data_preprocess`, except for ``warm_start``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The transformed tabular dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_preprocess</span><span class="p">(</span><span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.update_dataset">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.update_dataset.html#tabensemb.data.datamodule.DataModule.update_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">update_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update PyTorch tensors and datasets. This is called after features change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_tensors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">D</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_subset</span><span class="p">(</span>
            <span class="n">dataset</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tensors</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">D</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.generate_tensors">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.generate_tensors.html#tabensemb.data.datamodule.DataModule.generate_tensors">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaled_df</span><span class="p">,</span> <span class="n">derived_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate PyTorch tensors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scaled_df</span>
<span class="sd">            The scaled dataset.</span>
<span class="sd">        derived_data</span>
<span class="sd">            A dict of derived unstacked data calculated by :meth:`derive_unstacked`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        torch.Tensor</span>
<span class="sd">            A tensor of continuous features, a list of tensors of derived_unstacked data, and a tensor of the target.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">scaled_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">derived_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">scaled_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="DataModule.generate_subset">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.generate_subset.html#tabensemb.data.datamodule.DataModule.generate_subset">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Data</span><span class="o">.</span><span class="n">Dataset</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Data</span><span class="o">.</span><span class="n">Subset</span><span class="p">,</span> <span class="n">Data</span><span class="o">.</span><span class="n">Subset</span><span class="p">,</span> <span class="n">Data</span><span class="o">.</span><span class="n">Subset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split the dataset into training, validation and testing subsets.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset</span>
<span class="sd">            A ``torch.utils.data.Dataset`` instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        torch.utils.data.Subset</span>
<span class="sd">            Training, validation and testing subsets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">),</span>
            <span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">),</span>
            <span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.get_derived_data_slice">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_derived_data_slice.html#tabensemb.data.datamodule.DataModule.get_derived_data_slice">[docs]</a>
    <span class="k">def</span> <span class="nf">get_derived_data_slice</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">derived_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Iterable</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get slices of the derived unstacked data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        derived_data</span>
<span class="sd">            A dict of derived unstacked data calculated by :meth:`derive_unstacked``</span>
<span class="sd">        indices</span>
<span class="sd">            The indices to make slice.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The sliced derived unstacked data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_derived_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">derived_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tmp_derived_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">tmp_derived_data</span></div>


<div class="viewcode-block" id="DataModule.get_zero_slip">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_zero_slip.html#tabensemb.data.datamodule.DataModule.get_zero_slip">[docs]</a>
    <span class="k">def</span> <span class="nf">get_zero_slip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See how data processors act on a feature if its value is zero.</span>
<span class="sd">        It is a wrapper for :meth:`get_var_change`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature_name</span>
<span class="sd">            The investigated feature.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The transformed value for the feature using data processors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var_change</span><span class="p">(</span><span class="n">feature_name</span><span class="o">=</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.get_var_change">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_var_change.html#tabensemb.data.datamodule.DataModule.get_var_change">[docs]</a>
    <span class="k">def</span> <span class="nf">get_var_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See how data processors act on a feature if its value is ``value``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature_name</span>
<span class="sd">            The investigated feature.</span>
<span class="sd">        value</span>
<span class="sd">            The investigated value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value</span>
<span class="sd">            The transformed value for the feature using data processors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.dataprocessor</span> <span class="kn">import</span> <span class="n">AbstractTransformer</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dataprocessors&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run load_config first.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataprocessors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataprocessors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">record_cont_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2"> not available.&quot;</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataprocessors</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">AbstractTransformer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span>
                <span class="n">processor</span><span class="p">,</span> <span class="s2">&quot;transformer&quot;</span>
            <span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">var_slip</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span></div>


<div class="viewcode-block" id="DataModule.describe">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.describe.html#tabensemb.data.datamodule.DataModule.describe">[docs]</a>
    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scaled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Describe the dataset using ``pd.DataFrame.describe``, skewness, gini index, mode values, etc.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset is described.</span>
<span class="sd">        scaled</span>
<span class="sd">            Whether the scaled dataset is described.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The descriptions of the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tabular</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span><span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="n">scaled</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span>
        <span class="p">]</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">tabular</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

        <span class="n">skew</span> <span class="o">=</span> <span class="n">tabular</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">desc</span><span class="p">,</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">skew</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">skew</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">skew</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Skewness&quot;</span><span class="p">],</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gini</span><span class="p">(</span><span class="n">tabular</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">desc</span><span class="p">,</span> <span class="n">g</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">mode</span><span class="p">,</span> <span class="n">cnt_mode</span><span class="p">,</span> <span class="n">mode_percent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mode</span><span class="p">(</span><span class="n">tabular</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">desc</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cnt_mode</span><span class="p">,</span> <span class="n">mode_percent</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">kurtosis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_kurtosis</span><span class="p">(</span><span class="n">tabular</span><span class="p">)</span>
        <span class="n">kurtosis</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">desc</span><span class="p">,</span> <span class="n">kurtosis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">z_scores</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">tabular</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">tabular</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">tabular</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tabular</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">tabular</span><span class="p">[</span><span class="n">key</span><span class="p">])])</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tabular</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">}</span>
        <span class="n">z_score_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">z_scores</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Percentage of points with Z-score beyond 2&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">desc</span><span class="p">,</span> <span class="n">z_score_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">desc</span></div>


<div class="viewcode-block" id="DataModule.get_derived_data_sizes">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_derived_data_sizes.html#tabensemb.data.datamodule.DataModule.get_derived_data_sizes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_derived_data_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get dimensions of derived unstacked features.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sizes</span>
<span class="sd">            A list of np.ndarray.shape representing dimensions of each derived unstacked feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span></div>


<div class="viewcode-block" id="DataModule._get_gini">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule._get_gini.html#tabensemb.data.datamodule.DataModule._get_gini">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_gini</span><span class="p">(</span><span class="n">tabular</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the gini index for each feature in the tabular dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tabular</span>
<span class="sd">            The tabular dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The gini index for each feature in the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">gini</span><span class="p">(</span><span class="n">tabular</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tabular</span><span class="o">.</span><span class="n">columns</span><span class="p">]]),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">tabular</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Gini Index&quot;</span><span class="p">],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DataModule._get_kurtosis">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule._get_kurtosis.html#tabensemb.data.datamodule.DataModule._get_kurtosis">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_kurtosis</span><span class="p">(</span><span class="n">tabular</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the kurtosis for each feature in the tabular dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tabular</span>
<span class="sd">            The tabular dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The kurtosis for each feature in the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="n">tabular</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nan_policy</span><span class="o">=</span><span class="s2">&quot;omit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">tabular</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Kurtosis&quot;</span><span class="p">],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DataModule._get_mode">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule._get_mode.html#tabensemb.data.datamodule.DataModule._get_mode">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_mode</span><span class="p">(</span>
        <span class="n">tabular</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the mode value for each feature in the tabular dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tabular</span>
<span class="sd">            The tabular dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The mode value for each feature in the dataset.</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The number of the mode value for each feature.</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The percentage of the mode value for each feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">tabular</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">cnt_mode</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span>
                        <span class="n">tabular</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="n">mode</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">tabular</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Mode counts&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">mode_percent</span> <span class="o">=</span> <span class="n">cnt_mode</span> <span class="o">/</span> <span class="n">tabular</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">mode_percent</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mode percentage&quot;</span><span class="p">]</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">mode</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cnt_mode</span><span class="p">,</span> <span class="n">mode_percent</span></div>


<div class="viewcode-block" id="DataModule.pca">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.pca.html#tabensemb.data.datamodule.DataModule.pca">[docs]</a>
    <span class="k">def</span> <span class="nf">pca</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_idx</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PCA</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform ``sklearn.decomposition.PCA``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature_names</span>
<span class="sd">            A list of names of continuous features.</span>
<span class="sd">        feature_idx</span>
<span class="sd">            Indices in :attr:`cont_feature_names` of continuous features.</span>
<span class="sd">        indices</span>
<span class="sd">            Indices of investigated data points. If is None, :attr:`train_indices` is used.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Arguments of sklearn.decomposition.PCA.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sklearn.decomposition.PCA</span>
<span class="sd">            A ``sklearn.decomposition.PCA`` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">indices</span>
        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">feature_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">)[</span><span class="n">feature_idx</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">return</span> <span class="n">pca</span></div>


<div class="viewcode-block" id="DataModule.divide_from_tabular_dataset">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.divide_from_tabular_dataset.html#tabensemb.data.datamodule.DataModule.divide_from_tabular_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">divide_from_tabular_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get continuous feature data, categorical feature data, and label data respectively from the input DataFrame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data</span>
<span class="sd">            The tabular dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The continuous feature data.</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The categorical feature data.</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The label data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">]</span>
        <span class="n">categorical_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">]</span>
        <span class="n">label_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">feature_data</span><span class="p">,</span> <span class="n">categorical_data</span><span class="p">,</span> <span class="n">label_data</span></div>


<div class="viewcode-block" id="DataModule.get_tabular_dataset">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_tabular_dataset.html#tabensemb.data.datamodule.DataModule.get_tabular_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">get_tabular_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">transformed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">List</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the tabular dataset loaded in the DataModule.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        transformed</span>
<span class="sd">            Whether to return the scaled data or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The tabular dataset.</span>
<span class="sd">        List</span>
<span class="sd">            The continuous feature names in the dataset.</span>
<span class="sd">        List</span>
<span class="sd">            The categorical feature names in the dataset.</span>
<span class="sd">        List</span>
<span class="sd">            The target names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">transformed</span><span class="p">:</span>
            <span class="n">feature_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscaled_feature_data</span>

        <span class="n">cont_feature_names</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">)</span>
        <span class="n">cat_feature_names</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">)</span>
        <span class="n">label_name</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">)</span>

        <span class="n">tabular_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">feature_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorical_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">tabular_dataset</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">cat_feature_names</span><span class="p">,</span> <span class="n">label_name</span></div>


<div class="viewcode-block" id="DataModule.cal_corr">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.cal_corr.html#tabensemb.data.datamodule.DataModule.cal_corr">[docs]</a>
    <span class="k">def</span> <span class="nf">cal_corr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pearson&quot;</span><span class="p">,</span>
        <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">features_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Pearson correlation coefficients among continuous features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method</span>
<span class="sd">            The argument of ``pd.DataFrame.corr``. &quot;pearson&quot;, &quot;kendall&quot;, &quot;spearman&quot; or Callable.</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered. If False, some NaN values may exist for features that have</span>
<span class="sd">            missing values.</span>
<span class="sd">        features_only</span>
<span class="sd">            If False, the target is also considered.</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`select_by_value`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The correlation dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span>
            <span class="k">if</span> <span class="n">features_only</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span>
        <span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">imputed</span><span class="p">:</span>
            <span class="n">not_imputed_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_not_imputed_df</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">not_imputed_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="n">subset</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="n">subset</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.get_not_imputed_df">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_not_imputed_df.html#tabensemb.data.datamodule.DataModule.get_not_imputed_df">[docs]</a>
    <span class="k">def</span> <span class="nf">get_not_imputed_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the tabular data without imputation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The tabular dataset without imputation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_cont_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_imputed_mask</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp_cont_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_imputed_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">tmp_cat_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_imputed_mask</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp_cat_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_imputed_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">not_imputed_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">not_imputed_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">tmp_cont_df</span><span class="p">,</span> <span class="n">tmp_cat_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">not_imputed_df</span></div>


<div class="viewcode-block" id="DataModule.get_df">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_df.html#tabensemb.data.datamodule.DataModule.get_df">[docs]</a>
    <span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">scaled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the entire dataframe with certain processing steps.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether continuous and categorical features in the dataframe are imputed.</span>
<span class="sd">        scaled</span>
<span class="sd">            Whether continuous features in the dataframe are scaled.</span>
<span class="sd">        cat_transformed</span>
<span class="sd">            Whether categorical features in the dataframe are ordinal-encoded.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scaled</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scaled_df</span>
                <span class="k">if</span> <span class="n">imputed</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_transform</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">categories_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_not_imputed_df</span><span class="p">()),</span>
                    <span class="n">scaler_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="k">if</span> <span class="n">imputed</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_not_imputed_df</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">categories_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cat_transformed</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="DataModule._get_indices">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule._get_indices.html#tabensemb.data.datamodule.DataModule._get_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get training/validation/testing indices.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        partition</span>
<span class="sd">            &quot;train&quot;, &quot;val&quot;, &quot;test&quot;, or &quot;all&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The indices of the selected partition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indices_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">,</span>
            <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_indices</span><span class="p">,</span>
            <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">,</span>
            <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_data</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">partition</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Partition </span><span class="si">{</span><span class="n">partition</span><span class="si">}</span><span class="s2"> not available. Select among </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">indices_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">indices_map</span><span class="p">[</span><span class="n">partition</span><span class="p">]</span></div>


<div class="viewcode-block" id="DataModule.get_additional_tensors_slice">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_additional_tensors_slice.html#tabensemb.data.datamodule.DataModule.get_additional_tensors_slice">[docs]</a>
    <span class="k">def</span> <span class="nf">get_additional_tensors_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get slices of tensors of derived unstacked data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indices</span>
<span class="sd">            The indices to make the slice.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[torch.Tensor]</span>
<span class="sd">            Sliced derived unstacked tensors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensors</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tensors</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">tensor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tensor</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataModule.get_first_tensor_slice">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_first_tensor_slice.html#tabensemb.data.datamodule.DataModule.get_first_tensor_slice">[docs]</a>
    <span class="k">def</span> <span class="nf">get_first_tensor_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a slice of the tensor of continuous features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indices</span>
<span class="sd">            The indices to make the slice.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        torch.Tensor</span>
<span class="sd">            The sliced tensor of continuous feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span></div>


<div class="viewcode-block" id="DataModule.get_base_predictor">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.get_base_predictor.html#tabensemb.data.datamodule.DataModule.get_base_predictor">[docs]</a>
    <span class="k">def</span> <span class="nf">get_base_predictor</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">categorical</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sklearn</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestRegressor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a sklearn ``RandomForestRegressor`` for fundamental usages like pre-processing.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        categorical</span>
<span class="sd">            Whether to include ``OneHotEncoder`` for categorical features.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Arguments for ``sklearn.ensemble.RandomForestRegressor``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sklearn.pipeline.Pipeline or sklearn.ensemble.RandomForestRegressor</span>
<span class="sd">            A Pipeline if categorical is True, or a RandomForestRegressor if categorical is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
        <span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
        <span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
        <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
        <span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>

        <span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">categorical</span><span class="p">:</span>
            <span class="n">categorical_encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
            <span class="n">numerical_pipe</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
            <span class="n">preprocessing</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;cat&quot;</span><span class="p">,</span>
                        <span class="n">categorical_encoder</span><span class="p">,</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
                    <span class="p">),</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;num&quot;</span><span class="p">,</span>
                        <span class="n">numerical_pipe</span><span class="p">,</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span>
                            <span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">columns</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                <span class="p">],</span>
                <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">pip</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="s2">&quot;preprocess&quot;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">rf</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">pip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rf</span></div>


<div class="viewcode-block" id="DataModule.select_by_value">
<a class="viewcode-back" href="../../../api/generated/tabensemb.data.datamodule.DataModule.select_by_value.html#tabensemb.data.datamodule.DataModule.select_by_value">[docs]</a>
    <span class="k">def</span> <span class="nf">select_by_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">selection</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">partition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">left_closed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">right_closed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select data points with the given value(s) in the given column(s).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selection</span>
<span class="sd">            A dictionary whose items indicate the columns to be investigated and the values (if is a list/int/float/str)</span>
<span class="sd">            or a range of values (if is a tuple with two components) to be selected for each column.</span>
<span class="sd">        df</span>
<span class="sd">            A dataframe to be filtered. If not given, :attr:`df` is used.</span>
<span class="sd">        partition</span>
<span class="sd">            &quot;train&quot;, &quot;val&quot;, &quot;test&quot;, or &quot;all&quot;</span>
<span class="sd">        eps</span>
<span class="sd">            A tolerance value if the value to be selected is a float. If None, only values &quot;equal&quot; to the float will be</span>
<span class="sd">            selected.</span>
<span class="sd">        left_closed</span>
<span class="sd">            When the feature is filtered by a range, whether the left boundary is closed.</span>
<span class="sd">        right_closed</span>
<span class="sd">            When the feature is filtered by a range, whether the right boundary is closed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Indices of the selected data points in the dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">partition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provide only one of `partition` and `df`.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">partition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_indices</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="n">col_res_ls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">col_res</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">col_res</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">leq</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span>
                <span class="n">le</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span>
                <span class="n">left_op</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">leq</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">left_closed</span> <span class="k">else</span> <span class="n">le</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
                <span class="n">right_op</span> <span class="o">=</span> <span class="n">leq</span> <span class="k">if</span> <span class="n">right_closed</span> <span class="k">else</span> <span class="n">le</span>
                <span class="n">col_res</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">left_op</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">right_op</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">index</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">eps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">col_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[((</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="fm">__abs__</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">eps</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">col_res</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized selection of </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">col_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">col_res</span><span class="p">),</span> <span class="n">part</span><span class="p">))</span>
            <span class="n">col_res_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_res</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">,</span> <span class="n">col_res_ls</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span></div>
</div>

</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Tabular Ensemble developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>