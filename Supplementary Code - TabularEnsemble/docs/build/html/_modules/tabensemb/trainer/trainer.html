
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tabensemb.trainer.trainer &#8212; Tabular Ensemble 0.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/nbsphinx_dataframe.css?v=60cbb005" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script src="../../../_static/documentation_options.js?v=3b889da3"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/tabensemb/trainer/trainer';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    <p class="title logo__title">Tabular Ensemble 0.2 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/get_started.html">
                        Get Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/advanced_usage.html">
                        Advanced Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/api.html">
                        API References
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ANONYMOUS/tabular_ensemble" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/get_started.html">
                        Get Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/advanced_usage.html">
                        Advanced Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/api.html">
                        API References
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ANONYMOUS/tabular_ensemble" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">tabensemb.trainer.trainer</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for tabensemb.trainer.trainer</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">matplotlib.figure</span>
<span class="kn">import</span> <span class="nn">matplotlib.axes</span>
<span class="kn">import</span> <span class="nn">matplotlib.legend</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">tabensemb</span>
<span class="kn">from</span> <span class="nn">tabensemb.utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">tabensemb.config</span> <span class="kn">import</span> <span class="n">UserConfig</span>
<span class="kn">from</span> <span class="nn">tabensemb.data</span> <span class="kn">import</span> <span class="n">DataModule</span>
<span class="kn">from</span> <span class="nn">tabensemb.data.utils</span> <span class="kn">import</span> <span class="n">get_imputed_dtype</span><span class="p">,</span> <span class="n">fill_cat_nan</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span> <span class="k">as</span> <span class="n">cp</span>
<span class="kn">from</span> <span class="nn">skopt.space</span> <span class="kn">import</span> <span class="n">Real</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Categorical</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.cuda</span>
<span class="kn">import</span> <span class="nn">torch.utils.data</span> <span class="k">as</span> <span class="nn">Data</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">resample</span> <span class="k">as</span> <span class="n">skresample</span>
<span class="kn">import</span> <span class="nn">platform</span><span class="o">,</span> <span class="nn">psutil</span><span class="o">,</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">set_random_seed</span><span class="p">(</span><span class="n">tabensemb</span><span class="o">.</span><span class="n">setting</span><span class="p">[</span><span class="s2">&quot;random_seed&quot;</span><span class="p">])</span>


<div class="viewcode-block" id="Trainer">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.html#tabensemb.trainer.Trainer">[docs]</a>
<span class="k">class</span> <span class="nc">Trainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The model manager that provides saving, loading, ranking, and analyzing utilities.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">        A :class:`tabensemb.config.UserConfig` instance.</span>
<span class="sd">    configfile</span>
<span class="sd">        The source of the configuration. If the ``config`` argument of :meth:`load_config` is a</span>
<span class="sd">        :class:`tabensemb.config.UserConfig`, it is &quot;UserInputConfig&quot;. If the ``config`` argument is a path, it is the</span>
<span class="sd">        path. If the ``config`` argument is not given, it is the &quot;base&quot; argument passed to python when executing the</span>
<span class="sd">        script.</span>
<span class="sd">    datamodule</span>
<span class="sd">        A :class:`tabensemb.data.datamodule.DataModule` instance.</span>
<span class="sd">    device</span>
<span class="sd">        The device on which models are trained. &quot;cpu&quot;, &quot;cuda&quot;, or &quot;cuda:X&quot;.</span>
<span class="sd">    leaderboard</span>
<span class="sd">        The ranking of all models in all model bases. Only valid after :meth:`get_leaderboard` is called.</span>
<span class="sd">    modelbases</span>
<span class="sd">        A list of :class:`tabensemb.model.AbstractModel`.</span>
<span class="sd">    modelbases_names</span>
<span class="sd">        Corresponding names (:attr:`tabensemb.model.AbstractModel.program`) of :attr:`modelbases`.</span>
<span class="sd">    project</span>
<span class="sd">        The name of the :class:`Trainer`.</span>
<span class="sd">    project_root</span>
<span class="sd">        The place where all files are stored.</span>
<span class="sd">        ``tabensemb.setting[&quot;default_output_path&quot;]`` ``/{project}/{project_root_subfolder}/{TIME}-{config}`` where ``project`` is :attr:`project`,</span>
<span class="sd">        ``project_root_subfolder`` and ``config`` are arguments of :meth:`load_config`.</span>
<span class="sd">    sys_summary</span>
<span class="sd">        Summary of the system when :meth:`summarize_device` is called.</span>
<span class="sd">    SPACE</span>
<span class="sd">    all_feature_names</span>
<span class="sd">    cat_feature_mapping</span>
<span class="sd">    cat_feature_names</span>
<span class="sd">    chosen_params</span>
<span class="sd">    cont_feature_names</span>
<span class="sd">    derived_data</span>
<span class="sd">    derived_stacked_features</span>
<span class="sd">    df</span>
<span class="sd">    feature_data</span>
<span class="sd">    label_data</span>
<span class="sd">    label_name</span>
<span class="sd">    static_params</span>
<span class="sd">    tensors</span>
<span class="sd">    test_indices</span>
<span class="sd">    train_indices</span>
<span class="sd">    training</span>
<span class="sd">    unscaled_feature_data</span>
<span class="sd">    unscaled_label_data</span>
<span class="sd">    val_indices</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Trainer.__init__">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.html#tabensemb.trainer.Trainer.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The bridge of all modules. It contains all configurations and data. It can train model bases and evaluate</span>
<span class="sd">        results (including feature importance, partial dependency, etc.).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        device:</span>
<span class="sd">            The device on which models are trained. Choose from &quot;cpu&quot;, &quot;cuda&quot;, or &quot;cuda:X&quot; (if available).</span>
<span class="sd">        project:</span>
<span class="sd">            The name of the :class:`Trainer`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.set_device">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.set_device.html#tabensemb.trainer.Trainer.set_device">[docs]</a>
    <span class="k">def</span> <span class="nf">set_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the device on which models are trained.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        device</span>
<span class="sd">            &quot;cpu&quot;, &quot;cuda&quot;, or &quot;cuda:X&quot; (if available)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Multi-GPU training and training on a machine with multiple GPUs are not tested.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;cuda&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;cuda&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">device</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Device </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2"> is an invalid selection. Choose among </span><span class="si">{</span><span class="p">[</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cuda&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Note: Multi-GPU training and training on a machine with multiple GPUs are not tested.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span></div>


<div class="viewcode-block" id="Trainer.add_modelbases">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.add_modelbases.html#tabensemb.trainer.Trainer.add_modelbases">[docs]</a>
    <span class="k">def</span> <span class="nf">add_modelbases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a list of model bases and check whether their names conflict.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        models:</span>
<span class="sd">            A list of :class:`tabensemb.model.AbstractModel`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_modelbases_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">program</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">models</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_modelbases_names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_modelbases_names</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflicted model base names: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span> <span class="o">+=</span> <span class="n">models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span> <span class="o">=</span> <span class="n">new_modelbases_names</span></div>


<div class="viewcode-block" id="Trainer.get_modelbase">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.get_modelbase.html#tabensemb.trainer.Trainer.get_modelbase">[docs]</a>
    <span class="k">def</span> <span class="nf">get_modelbase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the selected model base by its name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The name of the model base.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        AbstractModel</span>
<span class="sd">            A model base.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">program</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model base </span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2"> not added to the trainer.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">program</span><span class="p">)]</span></div>


<div class="viewcode-block" id="Trainer.clear_modelbase">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.clear_modelbase.html#tabensemb.trainer.Trainer.clear_modelbase">[docs]</a>
    <span class="k">def</span> <span class="nf">clear_modelbase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all model bases in the :class:`Trainer`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Trainer.detach_modelbase">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.detach_modelbase.html#tabensemb.trainer.Trainer.detach_modelbase">[docs]</a>
    <span class="k">def</span> <span class="nf">detach_modelbase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Trainer&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detach the selected model base to a separate :class:`Trainer` and save it to another directory. It is much cheaper than</span>
<span class="sd">        :meth:`copy` if only one model base is needed. If any external model is required, please use :meth:``detach_model``</span>
<span class="sd">        to detach a single model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        verbose</span>
<span class="sd">            Verbosity</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Trainer</span>
<span class="sd">            A :class:`Trainer` with the selected model base.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`copy`, :meth:`detach_model`, :meth:`tabensemb.model.AbstractModel.detach_model`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modelbase</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">))</span>
        <span class="n">tmp_trainer</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">trainer</span>
        <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">clear_modelbase</span><span class="p">()</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">safe_mkdir</span><span class="p">(</span><span class="n">add_postfix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">))</span>
        <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">modelbase</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">program</span><span class="p">))</span>
        <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">add_modelbases</span><span class="p">([</span><span class="n">modelbase</span><span class="p">])</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">)</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">save_trainer</span><span class="p">(</span><span class="n">tmp_trainer</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmp_trainer</span></div>


<div class="viewcode-block" id="Trainer.detach_model">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.detach_model.html#tabensemb.trainer.Trainer.detach_model">[docs]</a>
    <span class="k">def</span> <span class="nf">detach_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Trainer&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detach the selected model of the selected model base to a separate :class:`Trainer` and save it to another</span>
<span class="sd">        directory. If external models are required, they are also detached into the separated Trainer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model.</span>
<span class="sd">        verbose</span>
<span class="sd">            Verbosity.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Trainer</span>
<span class="sd">            A :class:`Trainer` with the selected model in its model base.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">required_models_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">)</span><span class="o">.</span><span class="n">required_models</span><span class="p">(</span>
            <span class="n">model_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">required_models_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;EXTERN&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">required_models_names</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">tmp_trainer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmp_modelbase</span> <span class="o">=</span> <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">)</span>
            <span class="n">detached_model</span> <span class="o">=</span> <span class="n">tmp_modelbase</span><span class="o">.</span><span class="n">detach_model</span><span class="p">(</span>
                <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">program</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">required_models</span> <span class="o">=</span> <span class="n">tmp_modelbase</span><span class="o">.</span><span class="n">_get_required_models</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
            <span class="n">required_modelbases</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">model</span>
                    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">required_models</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;EXTERN&quot;</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">required_models</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="p">[]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp_trainer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detach_modelbase</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">tmp_modelbase</span> <span class="o">=</span> <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">)</span>
            <span class="n">detached_model</span> <span class="o">=</span> <span class="n">tmp_modelbase</span><span class="o">.</span><span class="n">detach_model</span><span class="p">(</span>
                <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">program</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">required_modelbases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">clear_modelbase</span><span class="p">()</span>
        <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">add_modelbases</span><span class="p">([</span><span class="n">detached_model</span><span class="p">]</span> <span class="o">+</span> <span class="n">required_modelbases</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmp_modelbase</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">save_trainer</span><span class="p">(</span><span class="n">tmp_trainer</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmp_trainer</span></div>


<div class="viewcode-block" id="Trainer.copy">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.copy.html#tabensemb.trainer.Trainer.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Trainer&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the :class:`Trainer` and save it to another directory. It might be time and space-consuming because all</span>
<span class="sd">        model bases are copied once.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        trainer</span>
<span class="sd">            A :class:`Trainer` instance.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`detach_modelbase`, :meth:`detach_model`, :meth:`tabensemb.model.AbstractModel.detach_model`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_trainer</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">safe_mkdir</span><span class="p">(</span><span class="n">add_postfix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">))</span>
        <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">modelbase</span> <span class="ow">in</span> <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">modelbases</span><span class="p">:</span>
            <span class="n">modelbase</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">program</span><span class="p">))</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="n">tmp_trainer</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_trainer</span><span class="p">(</span><span class="n">tmp_trainer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmp_trainer</span></div>


<div class="viewcode-block" id="Trainer.load_config">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.load_config.html#tabensemb.trainer.Trainer.load_config">[docs]</a>
    <span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UserConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">manual_config</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">project_root_subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the configuration using a :class:`tabensemb.config.UserConfig` or a file in .py or .json format.</span>
<span class="sd">        Arguments passed to python when executing the script are parsed using ``argparse`` if ``config`` is</span>
<span class="sd">        left None. All keys in :meth:`tabensemb.config.UserConfig.defaults` can be parsed, for example:</span>
<span class="sd">        For the loss function: ``--loss mse``,</span>
<span class="sd">        For the total epoch: ``--epoch 200``,</span>
<span class="sd">        For the option of bayes opt: ``--bayes_opt`` to turn on Bayesian hyperparameter optimization,</span>
<span class="sd">        ``--no-bayes_opt`` to turn it off.</span>
<span class="sd">        The loaded configuration will be saved as a .py file in the project folder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config</span>
<span class="sd">            It can be the path to the configuration file in json or python format, or a</span>
<span class="sd">            :class:`tabensemb.config.UserConfig` instance. If it is None, arguments passed to python will be parsed.</span>
<span class="sd">            If it is a path, it will be passed to :meth:`tabensemb.config.UserConfig.from_file`.</span>
<span class="sd">        manual_config</span>
<span class="sd">            Update the configuration with a dict. For example: ``manual_config={&quot;bayes_opt&quot;: True}``.</span>
<span class="sd">        project_root_subfolder</span>
<span class="sd">            The subfolder that the project will be locate in. The folder name will be</span>
<span class="sd">            ``tabensemb.setting[&quot;default_output_path&quot;]`` ``/{project}/{project_root_subfolder}/{TIME}-{config}``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">input_config</span><span class="p">:</span>
            <span class="c1"># The base config is loaded using the --base argument</span>
            <span class="k">if</span> <span class="n">is_notebook</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">input_config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;A config file must be assigned in notebook environment.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_notebook</span><span class="p">()</span> <span class="ow">or</span> <span class="n">input_config</span><span class="p">:</span>
                <span class="n">parse_res</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># not notebook and config is None</span>
                <span class="n">parse_res</span> <span class="o">=</span> <span class="n">UserConfig</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configfile</span> <span class="o">=</span> <span class="n">parse_res</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">]</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">UserConfig</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">configfile</span><span class="p">)</span>
            <span class="c1"># Then, several args can be modified using other arguments like --lr, --weight_decay</span>
            <span class="c1"># only when a config file is not given so that configs depend on input arguments.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_notebook</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">input_config</span><span class="p">:</span>
                <span class="c1"># If the argument is not given in the command, the item will be None and will not be merged into</span>
                <span class="c1"># `config` using the `merge` method.</span>
                <span class="n">config</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">parse_res</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">manual_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">config</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">manual_config</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">config</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configfile</span> <span class="o">=</span> <span class="s2">&quot;UserInputConfig&quot;</span>
            <span class="k">if</span> <span class="n">manual_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;manual_config is ignored when config is an UserConfig.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">config</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span> <span class="o">=</span> <span class="n">DataModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;database&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_dir</span><span class="p">(</span><span class="n">project_root_subfolder</span><span class="o">=</span><span class="n">project_root_subfolder</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;args.py&quot;</span><span class="p">))</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">static_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The &quot;patience&quot; and &quot;epoch&quot; parameters in the configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;patience&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;patience&quot;</span><span class="p">],</span>
            <span class="s2">&quot;epoch&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chosen_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The &quot;lr&quot;, &quot;weight_decay&quot;, and &quot;batch_size&quot; parameters in the configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;lr&quot;</span><span class="p">],</span>
            <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;weight_decay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">SPACE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search spaces for &quot;lr&quot;, &quot;weight_decay&quot;, and &quot;batch_size&quot; defined in the configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SPACE</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;SPACEs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">setting</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;SPACEs&quot;</span><span class="p">][</span><span class="n">var</span><span class="p">])</span>
            <span class="n">ty</span> <span class="o">=</span> <span class="n">setting</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="n">setting</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;Real&quot;</span><span class="p">:</span>
                <span class="n">SPACE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Real</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">setting</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;Categorical&quot;</span><span class="p">:</span>
                <span class="n">SPACE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Categorical</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">setting</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;Integer&quot;</span><span class="p">:</span>
                <span class="n">SPACE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">setting</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid type of skopt space.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SPACE</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :meth:`tabensemb.data.datamodule.DataModule.feature_data`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">feature_data</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unscaled_feature_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :meth:`tabensemb.data.datamodule.DataModule.unscaled_feature_data`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">unscaled_feature_data</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unscaled_label_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :meth:`tabensemb.data.datamodule.DataModule.unscaled_label_data`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">unscaled_label_data</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :meth:`tabensemb.data.datamodule.DataModule.label_data`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">label_data</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">derived_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.derived_data`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">derived_data</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cont_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.cont_feature_names`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cat_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.cat_feature_names`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cat_feature_names</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :meth:`tabensemb.data.datamodule.DataModule.all_feature_names`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">all_feature_names</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.label_name`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">label_name</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">train_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.train_indices`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">train_indices</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">val_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.val_indices`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">val_indices</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">test_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.test_indices`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">test_indices</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.df`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">df</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.tensors`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">tensors</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cat_feature_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.cat_feature_mapping`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cat_feature_mapping</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">derived_stacked_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :meth:`tabensemb.data.datamodule.DataModule.derived_stacked_features`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">derived_stacked_features</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">training</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :attr:`tabensemb.data.datamodule.DataModule.training`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">training</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datamodule&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="Trainer.set_status">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.set_status.html#tabensemb.trainer.Trainer.set_status">[docs]</a>
    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A wrapper of :meth:`tabensemb.data.datamodule.DataModule.set_status`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">training</span><span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.load_data">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.load_data.html#tabensemb.trainer.Trainer.load_data">[docs]</a>
    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A wrapper of :meth:`tabensemb.data.datamodule.DataModule.load_data`. The ``save_path`` argument is set to</span>
<span class="sd">        :attr:`project_root`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;save_path&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s2">&quot;save_path&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.set_path">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.set_path.html#tabensemb.trainer.Trainer.set_path">[docs]</a>
    <span class="k">def</span> <span class="nf">set_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the work directory of the :class:`Trainer`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path</span>
<span class="sd">            The work directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The project will be saved to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Trainer._create_dir">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._create_dir.html#tabensemb.trainer.Trainer._create_dir">[docs]</a>
    <span class="k">def</span> <span class="nf">_create_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">project_root_subfolder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the folder for the :class:`Trainer`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbose</span>
<span class="sd">            Whether to print the path of the :class:`Trainer`.</span>
<span class="sd">        project_root_subfolder</span>
<span class="sd">            See :meth:`load_config`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_path</span> <span class="o">=</span> <span class="n">tabensemb</span><span class="o">.</span><span class="n">setting</span><span class="p">[</span><span class="s2">&quot;default_output_path&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">default_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project_root_subfolder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="n">project_root_subfolder</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="n">project_root_subfolder</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
        <span class="n">subfolder</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
            <span class="k">if</span> <span class="n">project_root_subfolder</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_root_subfolder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">-%H-%M-%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>
        <span class="n">folder_name</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="s2">&quot;-0&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configfile</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span>
            <span class="n">safe_mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">)),</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.summarize_setting">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.summarize_setting.html#tabensemb.trainer.Trainer.summarize_setting">[docs]</a>
    <span class="k">def</span> <span class="nf">summarize_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the summary of the device, the configuration, and the global setting of the package</span>
<span class="sd">        (``tabensemb.setting``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Device:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pretty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summarize_device</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Configurations:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pretty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global settings:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pretty</span><span class="p">(</span><span class="n">tabensemb</span><span class="o">.</span><span class="n">setting</span><span class="p">))</span></div>


<div class="viewcode-block" id="Trainer.summarize_device">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.summarize_device.html#tabensemb.trainer.Trainer.summarize_device">[docs]</a>
    <span class="k">def</span> <span class="nf">summarize_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a summary of the environment.</span>
<span class="sd">        https://www.thepythoncode.com/article/get-hardware-system-information-python</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Scale bytes to its proper format</span>
<span class="sd">            e.g:</span>
<span class="sd">                1253656 =&gt; &#39;1.20MB&#39;</span>
<span class="sd">                1253656678 =&gt; &#39;1.17GB&#39;</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1024</span>
            <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">bytes</span> <span class="o">&lt;</span> <span class="n">factor</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">bytes</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}{</span><span class="n">unit</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="nb">bytes</span> <span class="o">/=</span> <span class="n">factor</span>

        <span class="k">def</span> <span class="nf">get_processor_info</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">platform</span><span class="o">.</span><span class="n">processor</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                        <span class="p">[</span><span class="s2">&quot;/usr/sbin/sysctl&quot;</span><span class="p">,</span> <span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;machdep.cpu.brand_string&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;cat /proc/cpuinfo&quot;</span>
                <span class="n">all_info</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">all_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s2">&quot;model name</span><span class="se">\t</span><span class="s2">: &quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">: &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">uname</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>
        <span class="n">cpufreq</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_freq</span><span class="p">()</span>
        <span class="n">svmem</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;System&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
            <span class="s2">&quot;Node name&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">node</span><span class="p">,</span>
            <span class="s2">&quot;System release&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
            <span class="s2">&quot;System version&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="s2">&quot;Machine architecture&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span>
            <span class="s2">&quot;Processor architecture&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">processor</span><span class="p">,</span>
            <span class="s2">&quot;Processor model&quot;</span><span class="p">:</span> <span class="n">get_processor_info</span><span class="p">(),</span>
            <span class="s2">&quot;Physical cores&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s2">&quot;Total cores&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">&quot;Max core frequency&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cpufreq</span><span class="o">.</span><span class="n">max</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">Mhz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Total memory&quot;</span><span class="p">:</span> <span class="n">get_size</span><span class="p">(</span><span class="n">svmem</span><span class="o">.</span><span class="n">total</span><span class="p">),</span>
            <span class="s2">&quot;Python version&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">(),</span>
            <span class="s2">&quot;Python implementation&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_implementation</span><span class="p">(),</span>
            <span class="s2">&quot;Python compiler&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_compiler</span><span class="p">(),</span>
            <span class="s2">&quot;Cuda availability&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">(),</span>
            <span class="s2">&quot;GPU devices&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_properties</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">device_count</span><span class="p">())</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_summary</span></div>


<div class="viewcode-block" id="Trainer.train">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.train.html#tabensemb.trainer.Trainer.train">[docs]</a>
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">programs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Train all model bases (:attr:`modelbases`).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        programs</span>
<span class="sd">            A selected subset of model bases.</span>
<span class="sd">        verbose</span>
<span class="sd">            Verbosity.</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments passed to :meth:`tabensemb.model.AbstractModel.train`</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Arguments passed to :meth:`tabensemb.model.AbstractModel.train`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">programs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modelbases_to_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">modelbases_to_train</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">programs</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelbases_to_train</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No modelbase is trained. Please confirm that trainer.add_modelbases is called.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">modelbase</span> <span class="ow">in</span> <span class="n">modelbases_to_train</span><span class="p">:</span>
            <span class="n">modelbase</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.cross_validation">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.cross_validation.html#tabensemb.trainer.Trainer.cross_validation">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_validation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">programs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">n_random</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">test_data_only</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">split_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cv&quot;</span><span class="p">,</span>
        <span class="n">load_from_previous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repeat :meth:`load_data`, train model bases, and evaluate all models for multiple times.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        programs</span>
<span class="sd">            A selected subset of model bases.</span>
<span class="sd">        n_random</span>
<span class="sd">            The number of repeats.</span>
<span class="sd">        verbose</span>
<span class="sd">            Verbosity.</span>
<span class="sd">        test_data_only</span>
<span class="sd">            Whether to evaluate models only on testing datasets.</span>
<span class="sd">        split_type</span>
<span class="sd">            The type of data splitting. &quot;random&quot; and &quot;cv&quot; are supported. Ignored when ``load_from_previous`` is True.</span>
<span class="sd">        load_from_previous</span>
<span class="sd">            Load the state of a previous run (mostly because of an unexpected interruption).</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.model.AbstractModel.train`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The results of a continuous run and a continued run (``load_from_previous=True``) are consistent.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dict in the following format:</span>
<span class="sd">            {keys: programs, values: {keys: model names, values: {keys: [&quot;Training&quot;, &quot;Testing&quot;, &quot;Validation&quot;], values:</span>
<span class="sd">            (Predicted values, true values)}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">programs_predictions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">program</span> <span class="ow">in</span> <span class="n">programs</span><span class="p">:</span>
            <span class="n">programs_predictions</span><span class="p">[</span><span class="n">program</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">load_from_previous</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">)</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">,</span> <span class="s2">&quot;cv_state.pkl&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No previous state to load from.&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">,</span> <span class="s2">&quot;cv_state.pkl&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">current_state</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">start_i</span> <span class="o">=</span> <span class="n">current_state</span><span class="p">[</span><span class="s2">&quot;i_random&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_state</span><span class="p">(</span><span class="n">current_state</span><span class="p">[</span><span class="s2">&quot;trainer&quot;</span><span class="p">])</span>
            <span class="n">programs_predictions</span> <span class="o">=</span> <span class="n">current_state</span><span class="p">[</span><span class="s2">&quot;programs_predictions&quot;</span><span class="p">]</span>
            <span class="n">reloaded_once_predictions</span> <span class="o">=</span> <span class="n">current_state</span><span class="p">[</span><span class="s2">&quot;once_predictions&quot;</span><span class="p">]</span>
            <span class="n">skip_program</span> <span class="o">=</span> <span class="n">reloaded_once_predictions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">start_i</span> <span class="o">&gt;=</span> <span class="n">n_random</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The loaded state is incompatible with the current setting.&quot;</span>
                <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Previous cross validation state is loaded.&quot;</span><span class="p">)</span>
            <span class="n">split_type</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;cv&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">datasplitter</span><span class="o">.</span><span class="n">cv_generator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="s2">&quot;random&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">skip_program</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">reloaded_once_predictions</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;cv&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">datasplitter</span><span class="o">.</span><span class="n">support_cv</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">datasplitter</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not support cross validation splitting. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Use its original regime instead.&quot;</span>
                <span class="p">)</span>
                <span class="n">split_type</span> <span class="o">=</span> <span class="s2">&quot;random&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">datasplitter</span><span class="o">.</span><span class="n">reset_cv</span><span class="p">(</span>
                <span class="n">cv</span><span class="o">=</span><span class="n">n_random</span> <span class="k">if</span> <span class="n">split_type</span> <span class="o">==</span> <span class="s2">&quot;cv&quot;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">n_random</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">func_save_state</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">,</span> <span class="s2">&quot;cv_state.pkl&quot;</span><span class="p">),</span> <span class="s2">&quot;wb&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_i</span><span class="p">,</span> <span class="n">n_random</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;----------------------------</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_random</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">split_type</span><span class="si">}</span><span class="s2">----------------------------&quot;</span>
                <span class="p">)</span>
            <span class="n">trainer_state</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_program</span><span class="p">:</span>
                <span class="n">current_state</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;trainer&quot;</span><span class="p">:</span> <span class="n">trainer_state</span><span class="p">,</span>
                    <span class="s2">&quot;i_random&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                    <span class="s2">&quot;programs_predictions&quot;</span><span class="p">:</span> <span class="n">programs_predictions</span><span class="p">,</span>
                    <span class="s2">&quot;once_predictions&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">func_save_state</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">HiddenPrints</span><span class="p">(</span><span class="n">disable_std</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">):</span>
                <span class="n">set_random_seed</span><span class="p">(</span><span class="n">tabensemb</span><span class="o">.</span><span class="n">setting</span><span class="p">[</span><span class="s2">&quot;random_seed&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
            <span class="n">once_predictions</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_program</span> <span class="k">else</span> <span class="n">reloaded_once_predictions</span>
            <span class="k">for</span> <span class="n">program</span> <span class="ow">in</span> <span class="n">programs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">skip_program</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">program</span> <span class="ow">in</span> <span class="n">once_predictions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping finished model base </span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">skip_program</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">modelbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
                <span class="n">modelbase</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">dump_trainer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">_predict_all</span><span class="p">(</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">test_data_only</span><span class="o">=</span><span class="n">test_data_only</span>
                <span class="p">)</span>
                <span class="n">once_predictions</span><span class="p">[</span><span class="n">program</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>
                <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">predictions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">programs_predictions</span><span class="p">[</span><span class="n">program</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="c1"># current_predictions is a reference, so modifications are directly applied to it.</span>
                        <span class="n">current_predictions</span> <span class="o">=</span> <span class="n">programs_predictions</span><span class="p">[</span><span class="n">program</span><span class="p">][</span><span class="n">model_name</span><span class="p">]</span>

                        <span class="k">def</span> <span class="nf">append_once</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                            <span class="n">current_predictions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">current_predictions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                                <span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">current_predictions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                                <span class="p">),</span>
                            <span class="p">)</span>

                        <span class="n">append_once</span><span class="p">(</span><span class="s2">&quot;Testing&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">test_data_only</span><span class="p">:</span>
                            <span class="n">append_once</span><span class="p">(</span><span class="s2">&quot;Training&quot;</span><span class="p">)</span>
                            <span class="n">append_once</span><span class="p">(</span><span class="s2">&quot;Validation&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">programs_predictions</span><span class="p">[</span><span class="n">program</span><span class="p">][</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="c1"># It is expected that only model bases in self is changed. datamodule is not updated because the cross</span>
                <span class="c1"># validation status should remain before load_data() is called.</span>
                <span class="n">trainer_state</span><span class="o">.</span><span class="n">modelbases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span>
                <span class="n">current_state</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;trainer&quot;</span><span class="p">:</span> <span class="n">trainer_state</span><span class="p">,</span>
                    <span class="s2">&quot;i_random&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                    <span class="s2">&quot;programs_predictions&quot;</span><span class="p">:</span> <span class="n">programs_predictions</span><span class="p">,</span>
                    <span class="s2">&quot;once_predictions&quot;</span><span class="p">:</span> <span class="n">once_predictions</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">func_save_state</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
            <span class="n">df_once</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cal_leaderboard</span><span class="p">(</span>
                <span class="n">once_predictions</span><span class="p">,</span> <span class="n">test_data_only</span><span class="o">=</span><span class="n">test_data_only</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">df_once</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;leaderboard_cv_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">trainer_state</span><span class="o">.</span><span class="n">modelbases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span>
            <span class="n">current_state</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;trainer&quot;</span><span class="p">:</span> <span class="n">trainer_state</span><span class="p">,</span>
                <span class="s2">&quot;i_random&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;programs_predictions&quot;</span><span class="p">:</span> <span class="n">programs_predictions</span><span class="p">,</span>
                <span class="s2">&quot;once_predictions&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">func_save_state</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;--------------------------End </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_random</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">split_type</span><span class="si">}</span><span class="s2">--------------------------&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">programs_predictions</span></div>


<div class="viewcode-block" id="Trainer.get_leaderboard">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.get_leaderboard.html#tabensemb.trainer.Trainer.get_leaderboard">[docs]</a>
    <span class="k">def</span> <span class="nf">get_leaderboard</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">test_data_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">dump_trainer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">cross_validation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">load_from_previous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">split_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cv&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run all model bases with/without cross validation for a leaderboard.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        test_data_only</span>
<span class="sd">            Whether to evaluate models only on testing datasets.</span>
<span class="sd">        dump_trainer</span>
<span class="sd">            Whether to save the :class:`Trainer`.</span>
<span class="sd">        cross_validation</span>
<span class="sd">            The number of cross-validation. See :meth:`cross_validation`. 0 to evaluate current trained models on the</span>
<span class="sd">            current dataset.</span>
<span class="sd">        verbose</span>
<span class="sd">            Verbosity.</span>
<span class="sd">        load_from_previous</span>
<span class="sd">            Load the state of a previous run (mostly because of an unexpected interruption).</span>
<span class="sd">        split_type</span>
<span class="sd">            The type of data splitting. &quot;random&quot; and &quot;cv&quot; are supported. Ignored when ``load_from_previous`` is True.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.model.AbstractModel.train`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The leaderboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No modelbase available. Run trainer.add_modelbases() first.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">cross_validation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">programs_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="p">(</span>
                <span class="n">programs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span><span class="p">,</span>
                <span class="n">n_random</span><span class="o">=</span><span class="n">cross_validation</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">test_data_only</span><span class="o">=</span><span class="n">test_data_only</span><span class="p">,</span>
                <span class="n">load_from_previous</span><span class="o">=</span><span class="n">load_from_previous</span><span class="p">,</span>
                <span class="n">split_type</span><span class="o">=</span><span class="n">split_type</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">programs_predictions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">modelbase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelbase</span><span class="o">.</span><span class="n">program</span><span class="si">}</span><span class="s2"> metrics&quot;</span><span class="p">)</span>
                <span class="n">programs_predictions</span><span class="p">[</span><span class="n">modelbase</span><span class="o">.</span><span class="n">program</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">_predict_all</span><span class="p">(</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">test_data_only</span><span class="o">=</span><span class="n">test_data_only</span>
                <span class="p">)</span>

        <span class="n">df_leaderboard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cal_leaderboard</span><span class="p">(</span>
            <span class="n">programs_predictions</span><span class="p">,</span> <span class="n">test_data_only</span><span class="o">=</span><span class="n">test_data_only</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">dump_trainer</span><span class="p">:</span>
            <span class="n">save_trainer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_leaderboard</span></div>


<div class="viewcode-block" id="Trainer.get_predict_leaderboard">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.get_predict_leaderboard.html#tabensemb.trainer.Trainer.get_predict_leaderboard">[docs]</a>
    <span class="k">def</span> <span class="nf">get_predict_leaderboard</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get prediction leaderboard of all models on an upcoming labeled dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df:</span>
<span class="sd">            A new tabular dataset that has the same structure as ``self.trainer.datamodule.X_test``.</span>
<span class="sd">        args</span>
<span class="sd">            Arguments of :meth:`tabensemb.model.AbstractModel.predict`.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Arguments of :meth:`tabensemb.model.AbstractModel.predict`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No modelbase available. Run trainer.add_modelbases() first.&quot;</span>
            <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">programs_predictions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">modelbase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelbase</span><span class="o">.</span><span class="n">program</span><span class="si">}</span><span class="s2"> metrics&quot;</span><span class="p">)</span>
            <span class="n">truth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">program_predictions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">get_model_names</span><span class="p">():</span>
                <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
                <span class="n">program_predictions</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Testing&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">truth</span><span class="p">)}</span>
            <span class="n">programs_predictions</span><span class="p">[</span><span class="n">modelbase</span><span class="o">.</span><span class="n">program</span><span class="p">]</span> <span class="o">=</span> <span class="n">program_predictions</span>
        <span class="n">df_leaderboard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cal_leaderboard</span><span class="p">(</span>
            <span class="n">programs_predictions</span><span class="p">,</span> <span class="n">test_data_only</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df_leaderboard</span></div>


<div class="viewcode-block" id="Trainer.get_approx_cv_leaderboard">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.get_approx_cv_leaderboard.html#tabensemb.trainer.Trainer.get_approx_cv_leaderboard">[docs]</a>
    <span class="k">def</span> <span class="nf">get_approx_cv_leaderboard</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">leaderboard</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate approximated averages and standard errors based on :meth:`cross_validation` results in the folder</span>
<span class="sd">        ``self.project_root/cv``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        leaderboard</span>
<span class="sd">            A reference leaderboard to be filled by avg and std, and to sort the returned DataFrame.</span>
<span class="sd">        save</span>
<span class="sd">            Save returned results locally with names &quot;leaderboard_approx_mean.csv&quot; and &quot;leaderboard_approx_std.csv&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Averages in the same format as the input ``leaderboard``. There is an additional column &quot;Rank&quot;.</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Standard errors in the same format as the input ``leaderboard``. There is an additional column &quot;Rank&quot;.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The returned results are approximations of the precise leaderboard from ``get_leaderboard``. Some metrics like</span>
<span class="sd">        RMSE may be different because data-point-wise and cross-validation-wise averaging are different.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">leaderboard_mean</span> <span class="o">=</span> <span class="n">leaderboard</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">leaderboard_std</span> <span class="o">=</span> <span class="n">leaderboard</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">leaderboard_mean</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">leaderboard_std</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">)):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cross validation folder </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cv&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> not found.&quot;</span>
            <span class="p">)</span>
            <span class="n">leaderboard_mean</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">leaderboard</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">leaderboard_std</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">leaderboard_std</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Program&quot;</span><span class="p">,</span> <span class="s2">&quot;Model&quot;</span><span class="p">])</span>
            <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">leaderboard_mean</span><span class="p">,</span> <span class="n">leaderboard_std</span>
        <span class="n">df_cvs</span><span class="p">,</span> <span class="n">programs</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cv_leaderboards</span><span class="p">()</span>
        <span class="n">modelwise_cv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelwise_cv_metrics</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">program</span> <span class="ow">in</span> <span class="n">programs</span><span class="p">:</span>
            <span class="n">program_models</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">program</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">program_models</span><span class="p">:</span>
                <span class="n">res_cv</span> <span class="o">=</span> <span class="n">modelwise_cv</span><span class="p">[</span><span class="n">program</span><span class="p">][</span><span class="n">model</span><span class="p">]</span>
                <span class="c1"># If numeric_only=True, only &quot;Rank&quot; is calculated somehow.</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">res_cv</span><span class="p">[</span><span class="n">metrics</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numeric_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">res_cv</span><span class="p">[</span><span class="n">metrics</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numeric_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">where_model</span> <span class="o">=</span> <span class="n">leaderboard_std</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">leaderboard_std</span><span class="p">[</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">program</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">leaderboard_std</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="p">)</span>
                <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">leaderboard_mean</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">where_model</span><span class="p">,</span> <span class="n">mean</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span>
                <span class="n">leaderboard_std</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">where_model</span><span class="p">,</span> <span class="n">std</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">leaderboard_mean</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;leaderboard_approx_mean.csv&quot;</span><span class="p">),</span>
                <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">leaderboard_std</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;leaderboard_approx_std.csv&quot;</span><span class="p">),</span>
                <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">leaderboard_mean</span><span class="p">,</span> <span class="n">leaderboard_std</span></div>


<div class="viewcode-block" id="Trainer.get_modelwise_cv_metrics">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.get_modelwise_cv_metrics.html#tabensemb.trainer.Trainer.get_modelwise_cv_metrics">[docs]</a>
    <span class="k">def</span> <span class="nf">get_modelwise_cv_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assemble cross-validation results in the folder ``self.project_root/cv`` for metrics of each model in each</span>
<span class="sd">        model base.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dict of dicts where each of them contains metrics of cross-validation of one model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_cvs</span><span class="p">,</span> <span class="n">programs</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cv_leaderboards</span><span class="p">()</span>
        <span class="n">res_cvs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">program</span> <span class="ow">in</span> <span class="n">programs</span><span class="p">:</span>
            <span class="n">res_cvs</span><span class="p">[</span><span class="n">program</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">program_models</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">program</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">program_models</span><span class="p">:</span>
                <span class="n">res_cvs</span><span class="p">[</span><span class="n">program</span><span class="p">][</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">df_cvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_cvs</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">cv_metrics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df_cvs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">cv_idx</span><span class="p">,</span> <span class="n">df_cv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_cvs</span><span class="p">):</span>
                    <span class="n">where_model</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_cv</span><span class="p">[</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">program</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                        <span class="n">df_cv</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span>
                    <span class="p">)</span>
                    <span class="n">model_metrics</span> <span class="o">=</span> <span class="n">df_cv</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">where_model</span><span class="p">][</span><span class="n">metrics</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                    <span class="n">cv_metrics</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">model_metrics</span>
                <span class="n">res_cvs</span><span class="p">[</span><span class="n">program</span><span class="p">][</span><span class="n">model</span><span class="p">][</span><span class="n">metrics</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_metrics</span>
                <span class="n">res_cvs</span><span class="p">[</span><span class="n">program</span><span class="p">][</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">program</span>
                <span class="n">res_cvs</span><span class="p">[</span><span class="n">program</span><span class="p">][</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="k">return</span> <span class="n">res_cvs</span></div>


<div class="viewcode-block" id="Trainer._read_cv_leaderboards">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._read_cv_leaderboards.html#tabensemb.trainer.Trainer._read_cv_leaderboards">[docs]</a>
    <span class="k">def</span> <span class="nf">_read_cv_leaderboards</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read cross-validation leaderboards in the folder ``self.project_root/cv``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Cross validation leaderboards</span>
<span class="sd">        list</span>
<span class="sd">            Model base names</span>
<span class="sd">        dict</span>
<span class="sd">            Model names in each model base</span>
<span class="sd">        list</span>
<span class="sd">            Metric names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cross validation folder </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cv&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> not found.&quot;</span>
            <span class="p">)</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">i</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="s2">&quot;leaderboard_cv&quot;</span> <span class="ow">in</span> <span class="n">i</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_cvs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">,</span> <span class="n">cv</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="n">cvs</span>
        <span class="p">]</span>
        <span class="n">programs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_cvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
        <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">a</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_cvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df_cvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">a</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Model&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">programs</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">df_cv</span> <span class="ow">in</span> <span class="n">df_cvs</span><span class="p">:</span>
            <span class="n">df_cv</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cv</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">df_cvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Program&quot;</span><span class="p">,</span> <span class="s2">&quot;Model&quot;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">df_cvs</span><span class="p">,</span> <span class="n">programs</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">metrics</span></div>


<div class="viewcode-block" id="Trainer._cal_leaderboard">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._cal_leaderboard.html#tabensemb.trainer.Trainer._cal_leaderboard">[docs]</a>
    <span class="k">def</span> <span class="nf">_cal_leaderboard</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">programs_predictions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]]</span>
        <span class="p">],</span>
        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_data_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the leaderboard based on results from :meth:`cross_validation` or</span>
<span class="sd">        :meth:`tabensemb.model.AbstractModel._predict_all`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        programs_predictions</span>
<span class="sd">            Results from :meth:`cross_validation`, or assembled results from</span>
<span class="sd">            :meth:`tabensemb.model.AbstractModel._predict_all`. See the source code of</span>
<span class="sd">            :meth:`get_leaderboard` for details.</span>
<span class="sd">        metrics</span>
<span class="sd">            The metrics that have been implemented in :func:`tabensemb.utils.utils.metric_sklearn`.</span>
<span class="sd">        test_data_only</span>
<span class="sd">            Whether to evaluate models only on testing datasets.</span>
<span class="sd">        save</span>
<span class="sd">            Whether to save the leaderboard locally and as an attribute in the :class:`Trainer`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The leaderboard dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;regression&quot;</span><span class="p">:</span> <span class="n">REGRESSION_METRICS</span><span class="p">,</span>
                <span class="s2">&quot;binary&quot;</span><span class="p">:</span> <span class="n">BINARY_METRICS</span><span class="p">,</span>
                <span class="s2">&quot;multiclass&quot;</span><span class="p">:</span> <span class="n">MULTICLASS_METRICS</span><span class="p">,</span>
            <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">task</span><span class="p">]</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">modelbase_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases_names</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">(</span>
                <span class="n">programs_predictions</span><span class="p">[</span><span class="n">modelbase_name</span><span class="p">],</span>
                <span class="n">metrics</span><span class="p">,</span>
                <span class="n">test_data_only</span><span class="o">=</span><span class="n">test_data_only</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelbase_name</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">df_leaderboard</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sorted_by</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">df_leaderboard</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Testing </span><span class="si">{</span><span class="n">sorted_by</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">test_data_only</span> <span class="k">else</span> <span class="n">sorted_by</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">df_leaderboard</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_leaderboard</span> <span class="o">=</span> <span class="n">df_leaderboard</span><span class="p">[[</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_leaderboard</span><span class="o">.</span><span class="n">columns</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">df_leaderboard</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;leaderboard.csv&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leaderboard</span> <span class="o">=</span> <span class="n">df_leaderboard</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_approx_cv_leaderboard</span><span class="p">(</span><span class="n">df_leaderboard</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_leaderboard</span></div>


<div class="viewcode-block" id="Trainer._plot_action_subplots">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._plot_action_subplots.html#tabensemb.trainer.Trainer._plot_action_subplots">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_action_subplots</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">meth_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">ls_kwarg_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">tqdm_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_title</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">titles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">twin_ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">get_figsize_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">meth_fix_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over a list to plot subplots in a single figure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ls</span>
<span class="sd">            The list to be iterated.</span>
<span class="sd">        ls_kwarg_name</span>
<span class="sd">            The argument name of the components in ``ls`` when the component is passed to ``meth_name`` one by one. If</span>
<span class="sd">            is None, the components in ``ls`` should be dictionaries and will be unpacked and passed to the method</span>
<span class="sd">            ``meth_name``.</span>
<span class="sd">        tqdm_active</span>
<span class="sd">            Whether to use a tqdm progress bar.</span>
<span class="sd">        meth_name</span>
<span class="sd">            The method to plot on a subplot. It has an argument named ``ax`` which indicates the subplot.</span>
<span class="sd">        with_title</span>
<span class="sd">            Whether each subplot has a title, which is the components in ``ls`` if ``titles`` is None.</span>
<span class="sd">        titles</span>
<span class="sd">            The titles of each subplot if ``with_title`` is True.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        xlabel</span>
<span class="sd">            The overall xlabel.</span>
<span class="sd">        ylabel</span>
<span class="sd">            The overall ylabel.</span>
<span class="sd">        twin_ylabel</span>
<span class="sd">            The overall ylabel of the twin x-axis.</span>
<span class="sd">        get_figsize_kwargs</span>
<span class="sd">            Arguments for :func:`tabensemb.utils.utils.get_figsize`.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure()``</span>
<span class="sd">        meth_fix_kwargs</span>
<span class="sd">            Fixed arguments of ``meth_name`` (except for ``ax`` and ``ls_kwarg_name``).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">            The figure that has plotted subplots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>

        <span class="k">def</span> <span class="nf">_iterator</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">item</span>

        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">get_figsize_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">max_col</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">width_per_item</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">height_per_item</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">14</span><span class="p">),</span>
            <span class="n">get_figsize_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">figsize</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_figsize</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">),</span> <span class="o">**</span><span class="n">get_figsize_kwargs_</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="o">**</span><span class="n">figure_kwargs_</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
        <span class="n">tqdm</span> <span class="o">=</span> <span class="n">tqdm</span> <span class="k">if</span> <span class="n">tqdm_active</span> <span class="k">else</span> <span class="n">_iterator</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">ls</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_title</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                    <span class="n">name</span> <span class="k">if</span> <span class="n">titles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">titles</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="n">fontsize</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meth_name</span><span class="p">)(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="o">**</span><span class="p">({</span><span class="n">ls_kwarg_name</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span> <span class="k">if</span> <span class="n">ls_kwarg_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span><span class="p">),</span>
                <span class="o">**</span><span class="n">meth_fix_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span>
            <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
            <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">twin_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">twin_ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">twin_ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">twin_ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span>
                <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
                <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">twin_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">twin_ylabel</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="Trainer._plot_action_get_df">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._plot_action_get_df.html#tabensemb.trainer.Trainer._plot_action_get_df">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_action_get_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">scaled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A wrapper of :meth:`tabensemb.data.datamodule.DataModule.get_df`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="n">scaled</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="n">cat_transformed</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_subplots">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_subplots.html#tabensemb.trainer.Trainer.plot_subplots">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_subplots</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">ls_kwarg_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">meth_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">with_title</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">titles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">twin_ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">get_figsize_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">meth_fix_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tqdm_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over a list to plot subplots in a single figure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ls</span>
<span class="sd">            The list to be iterated.</span>
<span class="sd">        ls_kwarg_name</span>
<span class="sd">            The argument name of the components in ``ls`` when the component is passed to ``meth_name``.</span>
<span class="sd">        meth_name</span>
<span class="sd">            The method to plot on a subplot. It has an argument named ``ax`` which indicates the subplot.</span>
<span class="sd">        with_title</span>
<span class="sd">            Whether each subplot has a title, which is the components in ``ls`` if ``titles`` is None.</span>
<span class="sd">        titles</span>
<span class="sd">            The titles of each subplot if ``with_title`` is True.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        xlabel</span>
<span class="sd">            The overall xlabel.</span>
<span class="sd">        ylabel</span>
<span class="sd">            The overall ylabel.</span>
<span class="sd">        twin_ylabel</span>
<span class="sd">            The overall ylabel of the twin x-axis.</span>
<span class="sd">        get_figsize_kwargs</span>
<span class="sd">            Arguments for :func:`tabensemb.utils.utils.get_figsize`.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure()``</span>
<span class="sd">        meth_fix_kwargs</span>
<span class="sd">            Fixed arguments of ``meth_name`` (except for ``ax`` and ``ls_kwarg_name``).</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure, or return the ``matplotlib.figure.Figure``</span>
<span class="sd">            instance.</span>
<span class="sd">        tqdm_active</span>
<span class="sd">            Whether to use a tqdm progress bar.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">            The figure that has plotted subplots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_subplots</span><span class="p">(</span>
            <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span>
            <span class="n">ls_kwarg_name</span><span class="o">=</span><span class="n">ls_kwarg_name</span><span class="p">,</span>
            <span class="n">meth_name</span><span class="o">=</span><span class="n">meth_name</span><span class="p">,</span>
            <span class="n">meth_fix_kwargs</span><span class="o">=</span><span class="n">meth_fix_kwargs</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">with_title</span><span class="o">=</span><span class="n">with_title</span><span class="p">,</span>
            <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
            <span class="n">twin_ylabel</span><span class="o">=</span><span class="n">twin_ylabel</span><span class="p">,</span>
            <span class="n">get_figsize_kwargs</span><span class="o">=</span><span class="n">get_figsize_kwargs</span><span class="p">,</span>
            <span class="n">figure_kwargs</span><span class="o">=</span><span class="n">figure_kwargs</span><span class="p">,</span>
            <span class="n">tqdm_active</span><span class="o">=</span><span class="n">tqdm_active</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;subplots.pdf&quot;</span><span class="p">),</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_truth_pred_all">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_truth_pred_all.html#tabensemb.trainer.Trainer.plot_truth_pred_all">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_truth_pred_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
        <span class="n">get_figsize_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tqdm_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare ground truth and prediction for all models in a model base.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        get_figsize_kwargs</span>
<span class="sd">            Arguments for :func:`tabensemb.utils.utils.get_figsize`.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure()``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure, or return the ``matplotlib.figure.Figure``</span>
<span class="sd">            instance.</span>
<span class="sd">        tqdm_active</span>
<span class="sd">            Whether to use a tqdm progress bar.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Arguments for :meth:`plot_truth_pred`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">            The figure if ``save_show_close`` is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modelbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
        <span class="n">model_names</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">get_model_names</span><span class="p">()</span>

        <span class="n">savefig_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;truth_pred.pdf&quot;</span><span class="p">)),</span>
            <span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_subplots</span><span class="p">(</span>
            <span class="n">ls</span><span class="o">=</span><span class="n">model_names</span><span class="p">,</span>
            <span class="n">ls_kwarg_name</span><span class="o">=</span><span class="s2">&quot;model_name&quot;</span><span class="p">,</span>
            <span class="n">meth_name</span><span class="o">=</span><span class="s2">&quot;plot_truth_pred&quot;</span><span class="p">,</span>
            <span class="n">meth_fix_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">with_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Ground truth&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span>
            <span class="n">get_figsize_kwargs</span><span class="o">=</span><span class="n">get_figsize_kwargs</span><span class="p">,</span>
            <span class="n">figure_kwargs</span><span class="o">=</span><span class="n">figure_kwargs</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs_</span><span class="p">,</span>
            <span class="n">tqdm_active</span><span class="o">=</span><span class="n">tqdm_active</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_truth_pred">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_truth_pred.html#tabensemb.trainer.Trainer.plot_truth_pred">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_truth_pred</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">kde_color</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">train_val_test</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">log_trans</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">central_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">upper_lim</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scatter_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare ground truth and prediction for one model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base</span>
<span class="sd">        kde_color</span>
<span class="sd">            Whether the scatters are colored by their KDE density. Ignored if ``train_val_test`` is &quot;all&quot;.</span>
<span class="sd">        train_val_test</span>
<span class="sd">            Which subset to be plotted. Choose from &quot;Training&quot;, &quot;Validation&quot;, &quot;Testing&quot;, and &quot;all&quot;.</span>
<span class="sd">        log_trans</span>
<span class="sd">            Whether the label data is in log scale.</span>
<span class="sd">        central_line</span>
<span class="sd">            Whether to plot a 45-degree diagonal line.</span>
<span class="sd">        upper_lim</span>
<span class="sd">            The upper limit of x/y-axis.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure()``</span>
<span class="sd">        scatter_kwargs</span>
<span class="sd">            Arguments for ``plt.scatter()``</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend()``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">handlelength</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">handleheight</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span>
            <span class="n">legend_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">select_by_value_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
            <span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
                <span class="n">imputed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">derived_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">get_derived_data_slice</span><span class="p">(</span>
                <span class="n">derived_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_data</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span>
            <span class="p">)</span>
            <span class="n">train_val_test</span> <span class="o">=</span> <span class="s2">&quot;User&quot;</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;User&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="p">)</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">derived_data</span><span class="o">=</span><span class="n">derived_data</span>
                    <span class="p">),</span>
                    <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="p">)</span><span class="o">.</span><span class="n">_predict_model</span><span class="p">(</span>
                <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
                <span class="n">test_data_only</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="n">train_val_test</span> <span class="o">!=</span> <span class="s2">&quot;Testing&quot;</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot_one</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="p">):</span>
            <span class="n">pred_y</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">metric_sklearn</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred_y</span><span class="p">,</span> <span class="s2">&quot;r2&quot;</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">metric_sklearn</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred_y</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> MSE Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, R2: </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">final_y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">y</span> <span class="k">if</span> <span class="n">log_trans</span> <span class="k">else</span> <span class="n">y</span>
            <span class="n">final_y_pred</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">pred_y</span> <span class="k">if</span> <span class="n">log_trans</span> <span class="k">else</span> <span class="n">pred_y</span>
            <span class="k">if</span> <span class="n">kde_color</span><span class="p">:</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">final_y</span><span class="p">,</span> <span class="n">final_y_pred</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">xy</span><span class="p">)(</span><span class="n">xy</span><span class="p">)</span>
                <span class="n">scatter_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                    <span class="n">scatter_kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scatter_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span> <span class="n">scatter_kwargs</span>
                <span class="p">)</span>
            <span class="n">scatter_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> dataset ($R^2$=</span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">scatter_kwargs_</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">final_y</span><span class="p">,</span> <span class="n">final_y_pred</span><span class="p">,</span> <span class="o">**</span><span class="n">scatter_kwargs_</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">train_val_test</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">plot_one</span><span class="p">(</span><span class="s2">&quot;Training&quot;</span><span class="p">,</span> <span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
            <span class="n">plot_one</span><span class="p">(</span><span class="s2">&quot;Validation&quot;</span><span class="p">,</span> <span class="n">clr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
            <span class="n">plot_one</span><span class="p">(</span><span class="s2">&quot;Testing&quot;</span><span class="p">,</span> <span class="n">clr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_one</span><span class="p">(</span><span class="n">train_val_test</span><span class="p">,</span> <span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log_trans</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">central_line</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">upper_lim</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">upper_lim</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                    <span class="s2">&quot;--&quot;</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">locmin</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span>
                <span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span> <span class="n">numticks</span><span class="o">=</span><span class="mi">20</span>
            <span class="p">)</span>

            <span class="c1"># ax.set_aspect(&quot;equal&quot;, &quot;box&quot;)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">locmin</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">locmin</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">NullFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">NullFormatter</span><span class="p">())</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">upper_lim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">upper_lim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ax.set_aspect(&quot;equal&quot;, &quot;box&quot;)</span>
            <span class="n">lx</span><span class="p">,</span> <span class="n">rx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ly</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">])</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">central_line</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                    <span class="s2">&quot;--&quot;</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span>
                <span class="n">program</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_truth_pred.pdf&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Ground truth&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.cal_feature_importance">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.cal_feature_importance.html#tabensemb.trainer.Trainer.cal_feature_importance">[docs]</a>
    <span class="k">def</span> <span class="nf">cal_feature_importance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;permutation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate feature importance using a specified model. If the model base is a</span>
<span class="sd">        :class:`tabensemb.model.TorchModel`, ``captum`` or ``shap`` is called to make permutations. If the model base</span>
<span class="sd">        is only a :class:`tabensemb.model.AbstractModel`, the calculation will be much slower.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        method</span>
<span class="sd">            The method to calculate importance. &quot;permutation&quot; or &quot;shap&quot;.</span>
<span class="sd">        kwargs</span>
<span class="sd">            kwargs for :meth:`tabensemb.model.AbstractModel.cal_feature_importance`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr</span>
<span class="sd">            Values of feature importance.</span>
<span class="sd">        importance_names</span>
<span class="sd">            Corresponding feature names. If the model base is a ``TorchModel``, all features including derived unstacked</span>
<span class="sd">            features will be included. Otherwise, only :meth:`all_feature_names` will be considered.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`tabensemb.model.AbstractModel.cal_feature_importance`,</span>
<span class="sd">        :meth:`tabensemb.model.TorchModel.cal_feature_importance`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modelbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">cal_feature_importance</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.cal_shap">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.cal_shap.html#tabensemb.trainer.Trainer.cal_shap">[docs]</a>
    <span class="k">def</span> <span class="nf">cal_shap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate SHAP values using a specified model. If the model base is a :class:`tabensemb.model.TorchModel`, the</span>
<span class="sd">        ``shap.DeepExplainer`` is used. Otherwise, ``shap.KernelExplainer`` is called, which is much slower, and</span>
<span class="sd">        shap.kmeans is called to summarize the training data to 10 samples as the background data and 10 random samples</span>
<span class="sd">        in the testing set is explained, which will bias the results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        kwargs</span>
<span class="sd">            kwargs for :meth:`tabensemb.model.AbstractModel.cal_shap`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr</span>
<span class="sd">            The SHAP values. If the model base is a `TorchModel`, all features including derived unstacked features will</span>
<span class="sd">            be included. Otherwise, only :meth:`all_feature_names` will be considered.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`tabensemb.model.AbstractModel.cal_shap`,</span>
<span class="sd">        :meth:`tabensemb.model.TorchModel.cal_shap`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modelbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">cal_shap</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_feature_importance">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_feature_importance.html#tabensemb.trainer.Trainer.plot_feature_importance">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_feature_importance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;permutation&quot;</span><span class="p">,</span>
        <span class="n">importance</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bar_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot feature importance of a model using :meth:`cal_feature_importance`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        method</span>
<span class="sd">            The method to calculate feature importance. &quot;permutation&quot; or &quot;shap&quot;.</span>
<span class="sd">        importance</span>
<span class="sd">            Passing feature importance values directly instead of calling</span>
<span class="sd">            :meth:`tabensemb.model.AbstractModel.cal_feature_importance` internally in this method.</span>
<span class="sd">        feature_names</span>
<span class="sd">            Names of features assigned to each `importance` value.</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``</span>
<span class="sd">        bar_kwargs</span>
<span class="sd">            Arguments for ``seaborn.barplot``.</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Other arguments of :meth:`tabensemb.model.AbstractModel.cal_feature_importance`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cal_feature_importance</span><span class="p">(</span>
                <span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">importance</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">(</span><span class="n">importance</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">bar_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">bar_kwargs</span>
        <span class="p">)</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">figure_kwargs</span><span class="p">)</span>

        <span class="n">where_effective</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-5</span>
        <span class="n">effective_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">names</span><span class="p">)[</span><span class="n">where_effective</span><span class="p">]</span>
        <span class="n">not_effective</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">effective_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_effective</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature importance less than 1e-5: </span><span class="si">{</span><span class="n">not_effective</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="n">where_effective</span><span class="p">]</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;attr&quot;</span><span class="p">,</span> <span class="s2">&quot;clr&quot;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">effective_names</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
        <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;attr&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;attr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_generate_feature_types_palette</span><span class="p">(</span><span class="n">clr</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># ax.set_facecolor((0.97,0.97,0.97))</span>
        <span class="c1"># plt.grid(axis=&#39;x&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># plt.barh(x,y, color= [clr_map[name] for name in x])</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">bar_kwargs_</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># ax.set_xlim([0, 1])</span>

        <span class="n">legend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_generate_feature_types_legends</span><span class="p">(</span>
            <span class="n">clr</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend_kwargs</span><span class="o">=</span><span class="n">legend_kwargs</span>
        <span class="p">)</span>
        <span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;permutation&quot;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Permutation feature importance&quot;</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;shap&quot;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;SHAP feature importance&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Feature importance&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;feature_importance_</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_partial_dependence_all">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_partial_dependence_all.html#tabensemb.trainer.Trainer.plot_partial_dependence_all">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_partial_dependence_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">get_figsize_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tqdm_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and plot partial dependence plots with bootstrapping.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        get_figsize_kwargs</span>
<span class="sd">            Arguments for :func:`tabensemb.utils.utils.get_figsize`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure, or return the ``matplotlib.figure.Figure``</span>
<span class="sd">            instance.</span>
<span class="sd">        tqdm_active</span>
<span class="sd">            Whether to use a tqdm progress bar.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Arguments for :meth:`plot_partial_dependence`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">            The figure if ``save_show_close`` is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">savefig_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;partial_dependence_</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_subplots</span><span class="p">(</span>
            <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">,</span>
            <span class="n">ls_kwarg_name</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span>
            <span class="n">meth_name</span><span class="o">=</span><span class="s2">&quot;plot_partial_dependence&quot;</span><span class="p">,</span>
            <span class="n">meth_fix_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">with_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Value of predictors ($10\%$-$90\%$ percentile)&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Predicted target&quot;</span><span class="p">,</span>
            <span class="n">get_figsize_kwargs</span><span class="o">=</span><span class="n">get_figsize_kwargs</span><span class="p">,</span>
            <span class="n">figure_kwargs</span><span class="o">=</span><span class="n">figure_kwargs</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs_</span><span class="p">,</span>
            <span class="n">tqdm_active</span><span class="o">=</span><span class="n">tqdm_active</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_partial_dependence">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_partial_dependence.html#tabensemb.trainer.Trainer.plot_partial_dependence">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_partial_dependence</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">refit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">log_trans</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">lower_lim</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">upper_lim</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
        <span class="n">n_bootstrap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">grid_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">CI</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plot_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_between_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bar_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hist_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and plot a partial dependence plot with bootstrapping for a feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        feature</span>
<span class="sd">            The selected feature to calculate partial dependence.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        refit</span>
<span class="sd">            Whether to refit models on bootstrapped datasets. See :meth:`_bootstrap_fit`.</span>
<span class="sd">        log_trans</span>
<span class="sd">            Whether the label data is in log scale.</span>
<span class="sd">        lower_lim</span>
<span class="sd">            Lower limit of all pdp plots.</span>
<span class="sd">        upper_lim</span>
<span class="sd">            Upper limit of all pdp plot.</span>
<span class="sd">        n_bootstrap</span>
<span class="sd">            The number of bootstrap evaluations. It should be greater than 0.</span>
<span class="sd">        grid_size</span>
<span class="sd">            The number of steps of all pdp plot.</span>
<span class="sd">        CI</span>
<span class="sd">            The confidence interval of pdp results calculated across multiple bootstrap runs.</span>
<span class="sd">        verbose</span>
<span class="sd">            Verbosity</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        plot_kwargs</span>
<span class="sd">            Arguments for ``ax.plot``.</span>
<span class="sd">        fill_between_kwargs</span>
<span class="sd">            Arguments for ``ax.fill_between``.</span>
<span class="sd">        bar_kwargs</span>
<span class="sd">            Arguments for ``ax.bar`` (used for frequencies of categorical features).</span>
<span class="sd">        hist_kwargs</span>
<span class="sd">            Arguments for ``ax.hist`` (used for histograms of continuous features).</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">x_values_list</span><span class="p">,</span>
            <span class="n">mean_pdp_list</span><span class="p">,</span>
            <span class="n">ci_left_list</span><span class="p">,</span>
            <span class="n">ci_right_list</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cal_partial_dependence</span><span class="p">(</span>
            <span class="n">feature_subset</span><span class="o">=</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span>
            <span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span>
            <span class="n">derived_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">D_train</span><span class="p">,</span>
            <span class="n">n_bootstrap</span><span class="o">=</span><span class="n">n_bootstrap</span><span class="p">,</span>
            <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">,</span>
            <span class="n">grid_size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
            <span class="n">percentile</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">CI</span><span class="o">=</span><span class="n">CI</span><span class="p">,</span>
            <span class="n">average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">x_values_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mean_pdp</span> <span class="o">=</span> <span class="n">mean_pdp_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ci_left</span> <span class="o">=</span> <span class="n">ci_left_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ci_right</span> <span class="o">=</span> <span class="n">ci_right_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">plot_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span> <span class="n">plot_kwargs</span>
        <span class="p">)</span>
        <span class="n">fill_between_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">fill_between_kwargs</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">log_trans</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">10</span><span class="o">**</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">transform</span><span class="p">(</span><span class="n">mean_pdp</span><span class="p">),</span> <span class="o">**</span><span class="n">plot_kwargs_</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">x_values</span><span class="p">,</span>
                <span class="n">transform</span><span class="p">(</span><span class="n">ci_left</span><span class="p">),</span>
                <span class="n">transform</span><span class="p">(</span><span class="n">ci_right</span><span class="p">),</span>
                <span class="o">**</span><span class="n">fill_between_kwargs_</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yerr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">transform</span><span class="p">(</span><span class="n">ci_left</span><span class="p">),</span> <span class="n">transform</span><span class="p">(</span><span class="n">ci_right</span><span class="p">)])</span>
                    <span class="o">-</span> <span class="n">transform</span><span class="p">(</span><span class="n">mean_pdp</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ci_left</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">transform</span><span class="p">(</span><span class="n">mean_pdp</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs_</span><span class="p">)</span>

        <span class="c1"># ax.set_xlim([0, 1])</span>
        <span class="k">if</span> <span class="n">log_trans</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">10</span><span class="o">**</span><span class="n">lower_lim</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">upper_lim</span><span class="p">])</span>
            <span class="n">locmin</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span>
                <span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span> <span class="n">numticks</span><span class="o">=</span><span class="mi">20</span>
            <span class="p">)</span>
            <span class="c1"># ax.xaxis.set_minor_locator(locmin)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">locmin</span><span class="p">)</span>
            <span class="c1"># ax.xaxis.set_minor_formatter(matplotlib.ticker.NullFormatter())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">NullFormatter</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_values</span><span class="p">):</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">hist_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">x_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">),</span> <span class="n">hist_kwargs</span>
            <span class="p">)</span>
            <span class="n">bar_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">),</span> <span class="n">bar_kwargs</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_hist</span><span class="p">(</span>
                <span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
                <span class="n">imputed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">x_values</span><span class="o">=</span><span class="n">x_values</span><span class="p">,</span>
                <span class="n">hist_kwargs</span><span class="o">=</span><span class="n">hist_kwargs_</span><span class="p">,</span>
                <span class="n">bar_kwargs</span><span class="o">=</span><span class="n">bar_kwargs_</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;Invalid interval&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;partial_dependence_</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">feature</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; ($10\%$-$90\%$ percentile)&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Predicted target&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.cal_partial_dependence">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.cal_partial_dependence.html#tabensemb.trainer.Trainer.cal_partial_dependence">[docs]</a>
    <span class="k">def</span> <span class="nf">cal_partial_dependence</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">feature_subset</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate partial dependency. See the source code of :meth:`plot_partial_dependence` for its usage.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature_subset</span>
<span class="sd">            A subset of :meth:`all_feature_names`.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Arguments for :meth:`_bootstrap_fit`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            x values for each feature</span>
<span class="sd">        list</span>
<span class="sd">            pdp values for each feature</span>
<span class="sd">        list</span>
<span class="sd">            lower confidence limits for each feature</span>
<span class="sd">        list</span>
<span class="sd">            upper confidence limits for each feature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_values_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mean_pdp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ci_left_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ci_right_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">feature_idx</span><span class="p">,</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span> <span class="k">if</span> <span class="n">feature_subset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">feature_subset</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculate PDP: &quot;</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">)</span>

            <span class="n">x_value</span><span class="p">,</span> <span class="n">model_predictions</span><span class="p">,</span> <span class="n">ci_left</span><span class="p">,</span> <span class="n">ci_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_fit</span><span class="p">(</span>
                <span class="n">focus_feature</span><span class="o">=</span><span class="n">feature_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

            <span class="n">x_values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_value</span><span class="p">)</span>
            <span class="n">mean_pdp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_predictions</span><span class="p">)</span>
            <span class="n">ci_left_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ci_left</span><span class="p">)</span>
            <span class="n">ci_right_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ci_right</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x_values_list</span><span class="p">,</span> <span class="n">mean_pdp_list</span><span class="p">,</span> <span class="n">ci_left_list</span><span class="p">,</span> <span class="n">ci_right_list</span></div>


<div class="viewcode-block" id="Trainer.plot_partial_dependence_2way_all">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_partial_dependence_2way_all.html#tabensemb.trainer.Trainer.plot_partial_dependence_2way_all">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_partial_dependence_2way_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">x_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">y_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">get_figsize_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tqdm_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and plot 2-way partial dependence plots with bootstrapping. One continuous feature is fixed for x-axis.</span>
<span class="sd">        The rest of the continuous features are on y-axis, respectively.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        x_feature</span>
<span class="sd">            The continuous feature fixed for x-axis.</span>
<span class="sd">        y_features</span>
<span class="sd">            Continuous features on y-axis respectively. If None, all other continuous features are used.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        get_figsize_kwargs</span>
<span class="sd">            Arguments for :func:`tabensemb.utils.utils.get_figsize`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure, or return the ``matplotlib.figure.Figure``</span>
<span class="sd">            instance.</span>
<span class="sd">        tqdm_active</span>
<span class="sd">            Whether to use a tqdm progress bar.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Arguments for :meth:`plot_partial_dependence_2way`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">            The figure if ``save_show_close`` is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y_features</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">y_features</span>
            <span class="k">if</span> <span class="n">y_features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">x_feature</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">savefig_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;partial_dependence_2way_</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">x_feature</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_subplots</span><span class="p">(</span>
            <span class="n">ls</span><span class="o">=</span><span class="n">y_features</span><span class="p">,</span>
            <span class="n">ls_kwarg_name</span><span class="o">=</span><span class="s2">&quot;y_feature&quot;</span><span class="p">,</span>
            <span class="n">meth_name</span><span class="o">=</span><span class="s2">&quot;plot_partial_dependence_2way&quot;</span><span class="p">,</span>
            <span class="n">meth_fix_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">x_feature</span><span class="o">=</span><span class="n">x_feature</span><span class="p">,</span> <span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">with_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Value of the fixed predictors&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Value of other predictors&quot;</span><span class="p">,</span>
            <span class="n">get_figsize_kwargs</span><span class="o">=</span><span class="n">get_figsize_kwargs</span><span class="p">,</span>
            <span class="n">figure_kwargs</span><span class="o">=</span><span class="n">figure_kwargs</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs_</span><span class="p">,</span>
            <span class="n">tqdm_active</span><span class="o">=</span><span class="n">tqdm_active</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_partial_dependence_2way">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_partial_dependence_2way.html#tabensemb.trainer.Trainer.plot_partial_dependence_2way">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_partial_dependence_2way</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">y_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">derived_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">projection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;3d&quot;</span><span class="p">,</span>
        <span class="n">grid_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">percentile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">imshow_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">surf_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and plot a 2-way partial dependence plot with bootstrapping for a pair of features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_feature</span>
<span class="sd">            A continuous feature.</span>
<span class="sd">        y_feature</span>
<span class="sd">            A continuous feature.</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        projection</span>
<span class="sd">            None or &quot;3d&quot;. Will use ``matplotlib.pyplot.imshow`` for None and ``matplotlib.pyplot.plot_surface`` for &quot;3d&quot;.</span>
<span class="sd">        grid_size</span>
<span class="sd">            The number of sequential values.</span>
<span class="sd">        percentile</span>
<span class="sd">            The percentile of the feature used to generate sequential values.</span>
<span class="sd">        df</span>
<span class="sd">            The tabular dataset.</span>
<span class="sd">        derived_data</span>
<span class="sd">            The derived data calculated using :meth:`derive_unstacked`.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Other arguments for :meth:`cal_partial_dependence_2way`.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        imshow_kwargs</span>
<span class="sd">            Arguments for ``plt.imshow``</span>
<span class="sd">        surf_kwargs</span>
<span class="sd">            Arguments for ``plt.plot_surface``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Arguments for :meth:`cal_partial_dependence_2way`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">imshow_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">imshow_kwargs</span><span class="p">)</span>
        <span class="n">surf_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">surf_kwargs</span>
        <span class="p">)</span>

        <span class="n">given_ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">given_ax</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">figure_kwargs_</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cal_partial_dependence_2way</span><span class="p">(</span>
            <span class="n">x_feature</span><span class="o">=</span><span class="n">x_feature</span><span class="p">,</span>
            <span class="n">y_feature</span><span class="o">=</span><span class="n">y_feature</span><span class="p">,</span>
            <span class="n">grid_size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
            <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">,</span>
            <span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">derived_data</span><span class="o">=</span><span class="n">derived_data</span><span class="p">,</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">projection</span> <span class="o">!=</span> <span class="s2">&quot;3d&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="o">**</span><span class="n">imshow_kwargs_</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="o">**</span><span class="n">surf_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;partial_dependence_2way_</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">x_feature</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">y_feature</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">x_feature</span>
            <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; ($</span><span class="si">{}</span><span class="s2">\%$-$</span><span class="si">{}</span><span class="s2">\%$ percentile)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">percentile</span><span class="p">),</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">y_feature</span>
            <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; ($</span><span class="si">{}</span><span class="s2">\%$-$</span><span class="si">{}</span><span class="s2">\%$ percentile)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">percentile</span><span class="p">),</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.cal_partial_dependence_2way">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.cal_partial_dependence_2way.html#tabensemb.trainer.Trainer.cal_partial_dependence_2way">[docs]</a>
    <span class="k">def</span> <span class="nf">cal_partial_dependence_2way</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">y_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">grid_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">percentile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">x_min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x_max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y_min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y_max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate 2-way partial dependency. See the source code of :meth:`plot_partial_dependence_2way` for its usage.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_feature</span>
<span class="sd">            A continuous feature.</span>
<span class="sd">        y_feature</span>
<span class="sd">            A continuous feature.</span>
<span class="sd">        grid_size</span>
<span class="sd">            The number of sequential values.</span>
<span class="sd">        percentile</span>
<span class="sd">            The percentile of the feature used to generate sequential values.</span>
<span class="sd">        x_min</span>
<span class="sd">            The lower limit of the generated sequential values of the first feature.</span>
<span class="sd">            It will override the left percentile.</span>
<span class="sd">        x_max</span>
<span class="sd">            The upper limit of the generated sequential values of the first feature.</span>
<span class="sd">            It will override the right percentile.</span>
<span class="sd">        y_min</span>
<span class="sd">            The lower limit of the generated sequential values of the second feature.</span>
<span class="sd">            It will override the left percentile.</span>
<span class="sd">        y_max</span>
<span class="sd">            The upper limit of the generated sequential values of the second feature.</span>
<span class="sd">            It will override the right percentile.</span>
<span class="sd">        df</span>
<span class="sd">            The tabular dataset.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Other arguments for :meth:`_bootstrap_fit`. The above `grid_size`, `percentile`, `y_min`, `y_max` are</span>
<span class="sd">            passed to it for the second feature.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The grid of the first feature</span>
<span class="sd">        list</span>
<span class="sd">            The grid of the second feature</span>
<span class="sd">        list</span>
<span class="sd">            pdp values of each first-feature value and each second-feature value in grids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y_values_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mean_pdp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x_values_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_grid</span><span class="p">(</span>
                <span class="n">feature</span><span class="o">=</span><span class="n">x_feature</span><span class="p">,</span>
                <span class="n">grid_size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
                <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">,</span>
                <span class="n">x_min</span><span class="o">=</span><span class="n">x_min</span><span class="p">,</span>
                <span class="n">x_max</span><span class="o">=</span><span class="n">x_max</span><span class="p">,</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">x_val</span> <span class="ow">in</span> <span class="n">x_values_list</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">x_feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_val</span>
            <span class="n">x_value</span><span class="p">,</span> <span class="n">model_predictions</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_fit</span><span class="p">(</span>
                <span class="n">focus_feature</span><span class="o">=</span><span class="n">y_feature</span><span class="p">,</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                <span class="n">grid_size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
                <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">,</span>
                <span class="n">x_min</span><span class="o">=</span><span class="n">y_min</span><span class="p">,</span>
                <span class="n">x_max</span><span class="o">=</span><span class="n">y_max</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">y_values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_value</span><span class="p">)</span>
            <span class="n">mean_pdp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_predictions</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_values_list</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_size</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_values_list</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_pdp_list</span><span class="p">),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_partial_err_all">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_partial_err_all.html#tabensemb.trainer.Trainer.plot_partial_err_all">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_partial_err_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">get_figsize_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tqdm_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate prediction absolute errors on the testing dataset, and plot histograms of high-error samples and</span>
<span class="sd">        low-error samples respectively.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        get_figsize_kwargs</span>
<span class="sd">            Arguments for :func:`tabensemb.utils.utils.get_figsize`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure, or return the ``matplotlib.figure.Figure``</span>
<span class="sd">            instance.</span>
<span class="sd">        tqdm_active</span>
<span class="sd">            Whether to use a tqdm progress bar.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Arguments for :meth:`plot_partial_err`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">            The figure if ``save_show_close`` is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">savefig_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;partial_err_</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_subplots</span><span class="p">(</span>
            <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">,</span>
            <span class="n">ls_kwarg_name</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span>
            <span class="n">meth_name</span><span class="o">=</span><span class="s2">&quot;plot_partial_err&quot;</span><span class="p">,</span>
            <span class="n">meth_fix_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">with_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Value of predictors&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prediction absolute error&quot;</span><span class="p">,</span>
            <span class="n">get_figsize_kwargs</span><span class="o">=</span><span class="n">get_figsize_kwargs</span><span class="p">,</span>
            <span class="n">figure_kwargs</span><span class="o">=</span><span class="n">figure_kwargs</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs_</span><span class="p">,</span>
            <span class="n">tqdm_active</span><span class="o">=</span><span class="n">tqdm_active</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_partial_err">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_partial_err.html#tabensemb.trainer.Trainer.plot_partial_err">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_partial_err</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">,</span>
        <span class="n">thres</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scatter_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hist_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate prediction absolute errors on the testing dataset, and plot histograms of high-error samples and</span>
<span class="sd">        low-error samples respectively for a single feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        feature</span>
<span class="sd">            The selected feature.</span>
<span class="sd">        thres</span>
<span class="sd">            The absolute error threshold to identify high-error samples and low-error samples.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        scatter_kwargs</span>
<span class="sd">            Arguments for ``ax.scatter()``</span>
<span class="sd">        hist_kwargs</span>
<span class="sd">            Arguments for ``ax.hist()``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">scatter_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">scatter_kwargs</span><span class="p">)</span>
        <span class="n">hist_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">hist_kwargs</span>
        <span class="p">)</span>

        <span class="n">feature_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span>
        <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">truth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">modelbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">X_test</span><span class="p">,</span>
            <span class="n">derived_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">D_test</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">truth</span> <span class="o">-</span> <span class="n">pred</span><span class="p">)</span>
        <span class="n">high_err_data</span> <span class="o">=</span> <span class="n">feature_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">err</span> <span class="o">&gt;</span> <span class="n">thres</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">high_err</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">err</span> <span class="o">&gt;</span> <span class="n">thres</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">low_err_data</span> <span class="o">=</span> <span class="n">feature_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;=</span> <span class="n">thres</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">low_err</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;=</span> <span class="n">thres</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">high_err_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">high_err</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">scatter_kwargs_</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">low_err_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">low_err</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">scatter_kwargs_</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">])</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">high_err_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">low_err_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">feature_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">feature_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                <span class="mi">20</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span>
            <span class="o">**</span><span class="n">hist_kwargs_</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">feature_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">tick_label</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_mapping</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">tick_label</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">])</span>

        <span class="c1"># sns.rugplot(data=chosen_data, height=0.05, ax=ax2, color=&#39;k&#39;)</span>
        <span class="c1"># ax2.set_ylim([0,1])</span>
        <span class="c1"># ax2.set_xlim([np.min(x_values_list[idx]), np.max(x_values_list[idx])])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;partial_err_</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prediction absolute error&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_err_hist">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_err_hist.html#tabensemb.trainer.Trainer.plot_err_hist">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_err_hist</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hist_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot histograms of prediction errors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        category</span>
<span class="sd">            The category to classify histograms and stack them with different colors.</span>
<span class="sd">        metric</span>
<span class="sd">            The metric to be calculated. It should be supported by :func:`tabenseb.utils.utils.auto_metric_sklearn`.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        legend</span>
<span class="sd">            Show legends if ``category`` is not None.</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        hist_kwargs</span>
<span class="sd">            Arguments for ``ax.hist`` (used for histograms of continuous features).</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend`` if ``legend`` is True and ``category`` is not None.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>
        <span class="n">hist_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="n">hist_kwargs</span>
        <span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">legend_kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">derived_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">get_derived_data_slice</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">derived_data</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span>
        <span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">derived_data</span><span class="o">=</span><span class="n">derived_data</span><span class="p">,</span> <span class="n">proba</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">truth</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="n">metric</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">metric</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;rmse&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;regression&quot;</span> <span class="k">else</span> <span class="s2">&quot;log_loss&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">auto_metric_sklearn</span><span class="p">(</span>
                    <span class="n">t</span><span class="p">,</span>
                    <span class="n">p</span><span class="p">,</span>
                    <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                    <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">category_data</span><span class="p">,</span> <span class="n">unique_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_category_unique_values</span><span class="p">(</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span>
            <span class="p">)</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">metrics</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">category_data</span> <span class="o">==</span> <span class="n">val</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_values</span>
            <span class="p">]</span>
            <span class="n">hist_kwargs_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)],</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">unique_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
                    <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="o">**</span><span class="n">hist_kwargs_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;err_hist.pdf&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span> <span class="k">if</span> <span class="n">hist_kwargs_</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_corr">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_corr.html#tabensemb.trainer.Trainer.plot_corr">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_corr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">imputed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pearson&quot;</span><span class="p">,</span>
        <span class="n">include_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">imshow_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot correlation coefficients among features and the target.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fontsize</span>
<span class="sd">            The ``fontsize`` argument for matplotlib.</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered. If False, some NaN coefficients may exist for features</span>
<span class="sd">            with missing values.</span>
<span class="sd">        features</span>
<span class="sd">            A subset of continuous features to calculate correlations on.</span>
<span class="sd">        method</span>
<span class="sd">            The argument of ``pd.DataFrame.corr``. &quot;pearson&quot;, &quot;kendall&quot;, &quot;spearman&quot; or Callable.</span>
<span class="sd">        include_label</span>
<span class="sd">            If True, the target is also considered.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        imshow_kwargs</span>
<span class="sd">            Arguments for ``plt.imshow``.</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">figure_kwargs</span>
        <span class="p">)</span>
        <span class="n">imshow_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;bwr&quot;</span><span class="p">),</span> <span class="n">imshow_kwargs</span><span class="p">)</span>

        <span class="n">cont_feature_names</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">features</span>
        <span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span> <span class="k">if</span> <span class="n">include_label</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="c1"># sns.reset_defaults()</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cal_corr</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span>
                <span class="n">features_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">select_by_value_kwargs</span><span class="o">=</span><span class="n">select_by_value_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">cont_feature_names</span><span class="p">]</span>
            <span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="o">**</span><span class="n">imshow_kwargs_</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cont_feature_names</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cont_feature_names</span><span class="p">)))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">cont_feature_names</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span>
            <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">norm_corr</span> <span class="o">=</span> <span class="n">corr</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">corr</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">norm_corr</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">norm_corr</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cont_feature_names</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cont_feature_names</span><span class="p">)):</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">j</span><span class="p">,</span>
                    <span class="n">i</span><span class="p">,</span>
                    <span class="nb">round</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">norm_corr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.3</span> <span class="k">else</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;corr</span><span class="si">{</span><span class="s1">&#39;_imputed&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">imputed</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_corr_with_label">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_corr_with_label.html#tabensemb.trainer.Trainer.plot_corr_with_label">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_corr_with_label</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">imputed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;alphabetic&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pearson&quot;</span><span class="p">,</span>
        <span class="n">clr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">barplot_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot correlation coefficients between the target and each feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered. If False, some NaN coefficients may exist for features</span>
<span class="sd">            with missing values.</span>
<span class="sd">        features</span>
<span class="sd">            A subset of continuous features to calculate correlations on.</span>
<span class="sd">        order</span>
<span class="sd">            The order of features. &quot;alphabetic&quot;, &quot;ascending&quot;, or &quot;descending&quot;.</span>
<span class="sd">        method</span>
<span class="sd">            The argument of ``pd.DataFrame.corr``. &quot;pearson&quot;, &quot;kendall&quot;, &quot;spearman&quot; or Callable.</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        imshow_kwargs</span>
<span class="sd">            Arguments for ``plt.imshow``.</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">barplot_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">saturation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">barplot_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">legend_kwargs</span><span class="p">)</span>

        <span class="n">is_horizontal</span> <span class="o">=</span> <span class="n">barplot_kwargs_</span><span class="p">[</span><span class="s2">&quot;orient&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span>

        <span class="n">cont_feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">features</span>

        <span class="c1"># sns.reset_defaults()</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cal_corr</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span>
                <span class="n">features_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">select_by_value_kwargs</span><span class="o">=</span><span class="n">select_by_value_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cont_feature_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">]</span>
            <span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="n">cont_feature_names</span><span class="p">,</span> <span class="s2">&quot;correlation&quot;</span><span class="p">:</span> <span class="n">corr</span><span class="p">})</span>
        <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">by</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span> <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="s2">&quot;alphabetic&quot;</span> <span class="k">else</span> <span class="s2">&quot;correlation&quot;</span><span class="p">,</span>
            <span class="n">ascending</span><span class="o">=</span><span class="n">order</span> <span class="o">!=</span> <span class="s2">&quot;descending&quot;</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_generate_feature_types_palette</span><span class="p">(</span>
            <span class="n">clr</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;correlation&quot;</span> <span class="k">if</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span> <span class="k">if</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="s2">&quot;correlation&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
            <span class="o">**</span><span class="n">barplot_kwargs_</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">legend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_generate_feature_types_legends</span><span class="p">(</span>
            <span class="n">clr</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend_kwargs</span><span class="o">=</span><span class="n">legend_kwargs_</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;corr_with_label</span><span class="si">{</span><span class="s1">&#39;_imputed&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">imputed</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Correlation with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Correlation with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_pairplot">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_pairplot.html#tabensemb.trainer.Trainer.plot_pairplot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_pairplot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">pairplot_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">sns</span><span class="o">.</span><span class="n">axisgrid</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot ``seaborn.pairplot`` among features and label. Kernel Density Estimation plots are on the diagonal.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered.</span>
<span class="sd">        features</span>
<span class="sd">            A subset of continuous features to plot pairplots for.</span>
<span class="sd">        include_label</span>
<span class="sd">            If True, the target is also considered.</span>
<span class="sd">        pairplot_kwargs</span>
<span class="sd">            Arguments for ``seaborn.pairplot``.</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure, or return the ``seaborn.axisgrid.PairGrid``</span>
<span class="sd">            instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pairplot_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">corner</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">diag_kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span><span class="p">),</span> <span class="n">pairplot_kwargs</span>
        <span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>

        <span class="n">cont_feature_names</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">features</span>
        <span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span> <span class="k">if</span> <span class="n">include_label</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="n">df_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)[</span><span class="n">cont_feature_names</span><span class="p">]</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:],</span> <span class="o">**</span><span class="n">pairplot_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;pair.jpg&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_feature_box">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_feature_box.html#tabensemb.trainer.Trainer.plot_feature_box">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_feature_box</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">boxplot_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot boxplot of the tabular data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``</span>
<span class="sd">        boxplot_kwargs</span>
<span class="sd">            Arguments for ``seaborn.boxplot``</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">boxplot_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">fliersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">flierprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">},</span>
                <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">saturation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">boxplot_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>

        <span class="c1"># sns.reset_defaults()</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">features</span><span class="p">]</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:],</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="o">**</span><span class="n">boxplot_kwargs_</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">boxes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_children</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">):</span>
                <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># ax.tick_params(axis=&#39;x&#39;, rotation=90)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;feature_box</span><span class="si">{</span><span class="s1">&#39;_imputed&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">imputed</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Values (Scaled)&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_hist_all">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_hist_all.html#tabensemb.trainer.Trainer.plot_hist_all">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_hist_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">imputed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">get_figsize_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tqdm_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot histograms of the tabular data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        get_figsize_kwargs</span>
<span class="sd">            Arguments for :func:`tabensemb.utils.utils.get_figsize`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure, or return the ``matplotlib.figure.Figure``</span>
<span class="sd">            instance.</span>
<span class="sd">        tqdm_active</span>
<span class="sd">            Whether to use a tqdm progress bar.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Arguments for :meth:`plot_hist`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">            The figure if ``save_show_close`` is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">savefig_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;hist</span><span class="si">{</span><span class="s1">&#39;_imputed&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">imputed</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_subplots</span><span class="p">(</span>
            <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">,</span>
            <span class="n">ls_kwarg_name</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span>
            <span class="n">meth_name</span><span class="o">=</span><span class="s2">&quot;plot_hist&quot;</span><span class="p">,</span>
            <span class="n">meth_fix_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">with_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Value of predictors&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span><span class="p">,</span>
            <span class="n">get_figsize_kwargs</span><span class="o">=</span><span class="n">get_figsize_kwargs</span><span class="p">,</span>
            <span class="n">figure_kwargs</span><span class="o">=</span><span class="n">figure_kwargs</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs_</span><span class="p">,</span>
            <span class="n">tqdm_active</span><span class="o">=</span><span class="n">tqdm_active</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_hist">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_hist.html#tabensemb.trainer.Trainer.plot_hist">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_hist</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">imputed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hist_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bar_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kde_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the histogram of a feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature</span>
<span class="sd">            The selected feature.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered.</span>
<span class="sd">        kde</span>
<span class="sd">            Plot the kernel density estimation along with each histogram of continuous features.</span>
<span class="sd">        category</span>
<span class="sd">            The category to classify histograms and stack them with different colors.</span>
<span class="sd">        x_values</span>
<span class="sd">            Unique values of the `feature`. If None, it will be inferred from the dataset.</span>
<span class="sd">        legend</span>
<span class="sd">            Show legends if ``category`` is not None.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        bar_kwargs</span>
<span class="sd">            Arguments for ``ax.bar`` (used for frequencies of categorical features).</span>
<span class="sd">        hist_kwargs</span>
<span class="sd">            Arguments for ``ax.hist`` (used for histograms of continuous features).</span>
<span class="sd">        kde_kwargs</span>
<span class="sd">            Arguments for :meth:`plot_kde` when ``kde`` is True.</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend`` if ``legend`` is True and ``category`` is not None.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>
        <span class="n">kde_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">select_by_value_kwargs</span><span class="o">=</span><span class="n">select_by_value_kwargs_</span><span class="p">),</span>
            <span class="n">kde_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">legend_kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">hist_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>
        <span class="n">hist_data</span> <span class="o">=</span> <span class="n">hist_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bar_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">bar_kwargs</span>
        <span class="p">)</span>
        <span class="n">hist_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">hist_kwargs</span>
        <span class="p">)</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">hist_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">x_values</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">x_values</span>
        <span class="p">)</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">x_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x_values</span><span class="p">)]</span>
        <span class="n">category_data</span><span class="p">,</span> <span class="n">category_unique_values</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_category_unique_values</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">hist_data</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">hist_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">values</span><span class="p">[</span><span class="n">category_data</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">category_unique_values</span>
                    <span class="p">]</span>
                    <span class="n">hist_kwargs_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_unique_values</span><span class="p">)],</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">category_unique_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                        <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;All-NaN slice encountered&quot;</span>
                    <span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">hist_kwargs_</span><span class="p">)</span>
                <span class="c1"># sns.rugplot(data=chosen_data, height=0.05, ax=ax2, color=&#39;k&#39;)</span>
                <span class="c1"># ax2.set_ylim([0,1])</span>
                <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hist_kwargs_</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_values</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">kde</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_kde</span><span class="p">(</span>
                        <span class="n">x_col</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kde_kwargs_</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_values</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_values</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">category_unique_values</span><span class="p">):</span>
                        <span class="n">category_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="nb">len</span><span class="p">(</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">category_data</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">x</span><span class="p">)[</span>
                                        <span class="mi">0</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_values</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">bar_kwargs_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span>
                        <span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                            <span class="n">x_values</span><span class="p">,</span>
                            <span class="n">category_counts</span><span class="p">,</span>
                            <span class="n">tick_label</span><span class="o">=</span><span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_mapping</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_values</span>
                            <span class="p">],</span>
                            <span class="o">**</span><span class="n">bar_kwargs_</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">bottom</span> <span class="o">+=</span> <span class="n">category_counts</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                        <span class="n">x_values</span><span class="p">,</span>
                        <span class="n">counts</span><span class="p">,</span>
                        <span class="n">tick_label</span><span class="o">=</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_mapping</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_values</span>
                        <span class="p">],</span>
                        <span class="o">**</span><span class="n">bar_kwargs_</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hist_kwargs_</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">])</span>
                    <span class="n">count_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="nb">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">count_range</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">count_range</span><span class="p">,</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                    <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">legend</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;Invalid interval&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;hist</span><span class="si">{</span><span class="s1">&#39;_imputed&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">imputed</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span> <span class="k">if</span> <span class="n">hist_kwargs_</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_on_one_axes">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_on_one_axes.html#tabensemb.trainer.Trainer.plot_on_one_axes">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_on_one_axes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">meth_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span>
        <span class="n">meth_kwargs_ls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
        <span class="n">twin</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">twin_ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meth_fix_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot multiple items on one ``matplotlib.axes.Axes``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        meth_name</span>
<span class="sd">            The method or a list of methods to plot multiple items. The method should have an argument named `ax` which</span>
<span class="sd">            indicates the subplot.</span>
<span class="sd">        meth_kwargs_ls</span>
<span class="sd">            A list of arguments of the corresponding ``meth_name`` (except for ``ax``).</span>
<span class="sd">        twin</span>
<span class="sd">            Plot one plot on ``ax`` and the next plot on ``ax.twin()``.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        xlabel</span>
<span class="sd">            The overall xlabel.</span>
<span class="sd">        ylabel</span>
<span class="sd">            The overall ylabel.</span>
<span class="sd">        twin_ylabel</span>
<span class="sd">            The overall ylabel of the twin x-axis if ``twin`` is True.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        meth_fix_kwargs</span>
<span class="sd">            Fixed arguments of ``meth_name`` (except for ``ax``, ``ls_kwarg_name``, and those given in</span>
<span class="sd">            ``meth_kwargs_ls``).</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend()``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>
<span class="sd">        legend</span>
<span class="sd">            Whether to show the legend.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">meth_fix_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">meth_fix_kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meth_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">meth_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">meth_name</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">meth_kwargs_ls</span><span class="p">)</span>

        <span class="n">current_ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="n">twin_ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span> <span class="k">if</span> <span class="n">twin</span> <span class="k">else</span> <span class="n">ax</span>
        <span class="k">for</span> <span class="n">meth</span><span class="p">,</span> <span class="n">meth_kwargs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">meth_name</span><span class="p">,</span> <span class="n">meth_kwargs_ls</span><span class="p">):</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meth</span><span class="p">)(</span><span class="n">ax</span><span class="o">=</span><span class="n">current_ax</span><span class="p">,</span> <span class="o">**</span><span class="n">meth_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">meth_fix_kwargs_</span><span class="p">)</span>
            <span class="n">current_ax</span> <span class="o">=</span> <span class="n">twin_ax</span> <span class="k">if</span> <span class="n">current_ax</span> <span class="o">==</span> <span class="n">ax</span> <span class="ow">and</span> <span class="n">twin</span> <span class="k">else</span> <span class="n">ax</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">handlers</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">twin</span><span class="p">:</span>
            <span class="n">twin_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">twin_ylabel</span><span class="p">)</span>
            <span class="n">handlers_twin</span><span class="p">,</span> <span class="n">labels_twin</span> <span class="o">=</span> <span class="n">twin_ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
            <span class="n">handlers</span> <span class="o">+=</span> <span class="n">handlers_twin</span>
            <span class="n">labels</span> <span class="o">+=</span> <span class="n">labels_twin</span>

        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handlers</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">),</span> <span class="n">legend_kwargs</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;plot_on_one_axes.pdf&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_scatter">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_scatter.html#tabensemb.trainer.Trainer.plot_scatter">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_scatter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">y_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">kde_color</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scatter_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot one column against another.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_col</span>
<span class="sd">            The column for the x-axis.</span>
<span class="sd">        y_col</span>
<span class="sd">            The column for the y-axis.</span>
<span class="sd">        category</span>
<span class="sd">            The category to classify data points with different colors and markers.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered.</span>
<span class="sd">        kde_color</span>
<span class="sd">            Whether the scatters are colored by their KDE density.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        scatter_kwargs</span>
<span class="sd">            Arguments for ``plt.scatter()``</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">scatter_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">scatter_kwargs</span><span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">legend_kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="n">x_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="n">y_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">isna</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">notna</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">isna</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kde_color</span><span class="p">:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">notna</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">notna</span><span class="p">]])</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">xy</span><span class="p">)(</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="n">scatter_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                <span class="n">scatter_kwargs_</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">notna</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">notna</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="o">**</span><span class="n">scatter_kwargs_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">notna</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">notna</span><span class="p">],</span> <span class="o">**</span><span class="n">scatter_kwargs_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_categorical_scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">notna</span><span class="p">],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">notna</span><span class="p">],</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">notna</span><span class="p">,</span> <span class="p">:],</span>
                    <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">clr</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span>
                    <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs_</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;scatter_</span><span class="si">{</span><span class="n">x_col</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">y_col</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">x_col</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">y_col</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_pdf">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_pdf.html#tabensemb.trainer.Trainer.plot_pdf">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_pdf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">dist</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">rv_continuous</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plot_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the probability density function of a feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature</span>
<span class="sd">            The investigated feature.</span>
<span class="sd">        dist</span>
<span class="sd">            The distribution to fit. It should be an instance of ``scipy.stats.rv_continuous`` that has ``fit`` and</span>
<span class="sd">            ``pdf`` methods.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        plot_kwargs</span>
<span class="sd">            Arguments for ``plt.plot``</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">plot_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">plot_kwargs</span><span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">dist</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">values</span><span class="p">)]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;pdf_</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability density&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_kde_all">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_kde_all.html#tabensemb.trainer.Trainer.plot_kde_all">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_kde_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">imputed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">get_figsize_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tqdm_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the kernel density estimation for each feature in the tabular data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        fontsize</span>
<span class="sd">            ``plt.rcParams[&quot;font.size&quot;]``</span>
<span class="sd">        get_figsize_kwargs</span>
<span class="sd">            Arguments for :func:`tabensemb.utils.utils.get_figsize`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure, or return the ``matplotlib.figure.Figure``</span>
<span class="sd">            instance.</span>
<span class="sd">        tqdm_active</span>
<span class="sd">            Whether to use a tqdm progress bar.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Arguments for :meth:`plot_kde`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">            The figure if ``save_show_close`` is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">savefig_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;kdes</span><span class="si">{</span><span class="s1">&#39;_imputed&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">imputed</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_subplots</span><span class="p">(</span>
            <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">,</span>
            <span class="n">ls_kwarg_name</span><span class="o">=</span><span class="s2">&quot;x_col&quot;</span><span class="p">,</span>
            <span class="n">meth_name</span><span class="o">=</span><span class="s2">&quot;plot_kde&quot;</span><span class="p">,</span>
            <span class="n">meth_fix_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">with_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Value of features&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span><span class="p">,</span>
            <span class="n">get_figsize_kwargs</span><span class="o">=</span><span class="n">get_figsize_kwargs</span><span class="p">,</span>
            <span class="n">figure_kwargs</span><span class="o">=</span><span class="n">figure_kwargs</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs_</span><span class="p">,</span>
            <span class="n">tqdm_active</span><span class="o">=</span><span class="n">tqdm_active</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_kde">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_kde.html#tabensemb.trainer.Trainer.plot_kde">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_kde</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">y_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">imputed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kdeplot_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the kernel density estimation of a feature or two features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_col</span>
<span class="sd">            The investigated feature.</span>
<span class="sd">        y_col</span>
<span class="sd">            If not None, a bi-variate distribution will be plotted.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        imputed</span>
<span class="sd">            Whether the imputed dataset should be considered.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        kdeplot_kwargs</span>
<span class="sd">            Arguments for ``seaborn.kdeplot``</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">kdeplot_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">kdeplot_kwargs</span><span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="n">imputed</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_col</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kdeplot_kwargs_</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;kde_</span><span class="si">{</span><span class="n">x_col</span><span class="si">}{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">y_col</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">y_col</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">x_col</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span> <span class="k">if</span> <span class="n">y_col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">y_col</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_presence_ratio">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_presence_ratio.html#tabensemb.trainer.Trainer.plot_presence_ratio">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_presence_ratio</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">barplot_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the ratio of presence of each feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        order</span>
<span class="sd">            &quot;ratio&quot; or &quot;type&quot;. If is &quot;ratio&quot;, the labels will be sorted by the presence ratio. If is &quot;type&quot;, the labels</span>
<span class="sd">            will be sorted first by their feature types defined in the configuration, and then sorted by the presence</span>
<span class="sd">            ratio.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        barplot_kwargs</span>
<span class="sd">            Arguments for ``seaborn.barplot``</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">barplot_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">hue_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">unique_feature_types_with_derived</span><span class="p">(),</span>
                <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">saturation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">barplot_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">legend_kwargs</span>
        <span class="p">)</span>
        <span class="n">is_horizontal</span> <span class="o">=</span> <span class="n">barplot_kwargs_</span><span class="p">[</span><span class="s2">&quot;orient&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span>

        <span class="n">cont_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cont_imputed_mask</span>
        <span class="n">cat_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cat_imputed_mask</span>
        <span class="n">cont_presence_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cont_mask</span><span class="p">)</span> <span class="o">/</span> <span class="n">cont_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cat_presence_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cat_mask</span><span class="p">)</span> <span class="o">/</span> <span class="n">cat_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">presence_ratio</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cont_presence_ratio</span><span class="p">,</span> <span class="n">cat_presence_ratio</span><span class="p">])</span>
        <span class="n">presence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="n">presence_ratio</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="n">presence_ratio</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">get_feature_types</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">presence_ratio</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">allow_unknown</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">presence</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;types&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="s2">&quot;type&quot;</span> <span class="k">else</span> <span class="s2">&quot;ratio&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_generate_feature_types_palette</span><span class="p">(</span>
            <span class="n">clr</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">presence</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">presence</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span> <span class="k">if</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span> <span class="k">if</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
            <span class="o">**</span><span class="n">barplot_kwargs_</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;set_xlim&quot;</span> <span class="k">if</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="s2">&quot;set_ylim&quot;</span><span class="p">)([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">legend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_generate_feature_types_legends</span><span class="p">(</span>
            <span class="n">clr</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend_kwargs</span><span class="o">=</span><span class="n">legend_kwargs_</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;presence_ratio.pdf&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Presence ratio&quot;</span> <span class="k">if</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Presence ratio&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_horizontal</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_fill_rating">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_fill_rating.html#tabensemb.trainer.Trainer.plot_fill_rating">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_fill_rating</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hist_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the histogram of data point rating which is the percentage of filled features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        category</span>
<span class="sd">            The category to classify histograms and stack them with different colors.</span>
<span class="sd">        legend</span>
<span class="sd">            Show legends if ``category`` is not None.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        hist_kwargs</span>
<span class="sd">            Arguments for ``plt.hist``.</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend`` if ``legend`` is True and ``category`` is not None.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        Zhang, Zian, and Zhiping Xu. Fatigue Database of Additively Manufactured Alloys. Scientific Data 10, no. 1 (May 2, 2023): 249.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">hist_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">hist_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">legend_kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">cont_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cont_imputed_mask</span><span class="o">.</span><span class="n">values</span>
        <span class="n">cat_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cat_imputed_mask</span><span class="o">.</span><span class="n">values</span>
        <span class="n">cont_presence_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cont_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cat_presence_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cat_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rating</span> <span class="o">=</span> <span class="p">(</span><span class="n">cont_presence_features</span> <span class="o">+</span> <span class="n">cat_presence_features</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># augmented data points should not be included.</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
                <span class="n">imputed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cont_imputed_mask</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">category_data</span><span class="p">,</span> <span class="n">unique_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_category_unique_values</span><span class="p">(</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span>
            <span class="p">)</span>
            <span class="n">rating</span> <span class="o">=</span> <span class="p">[</span><span class="n">rating</span><span class="p">[</span><span class="n">category_data</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">]</span>
            <span class="n">hist_kwargs_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">unique_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
                    <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span> <span class="o">**</span><span class="n">hist_kwargs_</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">legend</span> <span class="ow">and</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;fill_rating.pdf&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Fill rating&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_categorical_presence_ratio">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_categorical_presence_ratio.html#tabensemb.trainer.Trainer.plot_categorical_presence_ratio">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_categorical_presence_ratio</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">imshow_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cbar_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cbar_ax_linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">cbar_ax_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the ratio of presence of each feature, but is classified by a categorical variable.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        category</span>
<span class="sd">            The category (usually data sources) to classify data points.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        imshow_kwargs</span>
<span class="sd">            Arguments for ``plt.imshow``.</span>
<span class="sd">        cbar_kwargs</span>
<span class="sd">            Arguments for ``plt.colorbar``.</span>
<span class="sd">        cbar_ax_linewidth</span>
<span class="sd">            Line width of bounding box of cbar.</span>
<span class="sd">        cbar_ax_kwargs</span>
<span class="sd">            Arguments for ``mpl_toolkits.axes_grid1.inset_locator.inset_axes``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">imshow_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">),</span> <span class="n">imshow_kwargs</span><span class="p">)</span>
        <span class="n">cbar_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">cbar_kwargs</span><span class="p">)</span>

        <span class="n">cont_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cont_imputed_mask</span>
        <span class="n">cat_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">cat_imputed_mask</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span>
            <span class="n">imputed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cont_mask</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">category_data</span><span class="p">,</span> <span class="n">unique_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_category_unique_values</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span>
        <span class="p">)</span>

        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_values</span><span class="p">):</span>
            <span class="n">cls_indices</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">category_data</span> <span class="o">==</span> <span class="bp">cls</span><span class="p">]</span>
            <span class="n">cont_presence_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cont_mask</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cls_indices</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">cls_indices</span>
            <span class="p">)</span>
            <span class="n">cat_presence_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cat_mask</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cls_indices</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">cls_indices</span>
            <span class="p">)</span>
            <span class="n">presence_ratio</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cont_presence_ratio</span><span class="p">,</span> <span class="n">cat_presence_ratio</span><span class="p">])</span>
            <span class="n">mat</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">presence_ratio</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">]</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mat</span> <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span> <span class="k">else</span> <span class="n">mat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">imshow_kwargs_</span><span class="p">)</span>

        <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span> <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">)(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span> <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">)(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span> <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">)(</span><span class="n">unique_values</span><span class="p">)</span>
        <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span> <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">)(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_feature_names</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span>
            <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>

        <span class="n">cbar_ax_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="s2">&quot;20%&quot;</span><span class="p">,</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">borderpad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">cbar_ax_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">axins</span> <span class="o">=</span> <span class="n">inset_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar_ax_kwargs_</span><span class="p">)</span>

        <span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">axins</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar_kwargs_</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Presence ratio&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">cbar_ax_linewidth</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">cbar_ax_linewidth</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">cbar_ax_linewidth</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;presence_ratio_</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_pca_2d_visual">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_pca_2d_visual.html#tabensemb.trainer.Trainer.plot_pca_2d_visual">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_pca_2d_visual</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pca_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scatter_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">select_by_value_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit a ``sklearn.decomposition.PCA`` on a set of features, and plot its first two principal components as</span>
<span class="sd">        scatters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        category</span>
<span class="sd">            The category to classify data points with different colors and markers.</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        features</span>
<span class="sd">            A subset of continuous features to fit the PCA.</span>
<span class="sd">        pca_kwargs</span>
<span class="sd">            Arguments for ``sklearn.decomposition.PCA.fit``</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        scatter_kwargs</span>
<span class="sd">            Arguments for ``plt.scatter``</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend``</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        select_by_value_kwargs</span>
<span class="sd">            Arguments for :meth:`tabensemb.data.datamodule.DataModule.select_by_value`.</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span> <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">features</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">pca_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">pca_kwargs</span><span class="p">)</span>
        <span class="n">scatter_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">scatter_kwargs</span><span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">category</span><span class="p">),</span> <span class="n">legend_kwargs</span><span class="p">)</span>
        <span class="n">select_by_value_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(),</span> <span class="n">select_by_value_kwargs</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">select_by_value</span><span class="p">(</span><span class="o">**</span><span class="n">select_by_value_kwargs_</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_get_df</span><span class="p">(</span><span class="n">imputed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cat_transformed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">pca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span>
            <span class="n">feature_names</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="o">**</span><span class="n">pca_kwargs_</span>
        <span class="p">)</span>
        <span class="n">low_dim_rep</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">])</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">low_dim_rep</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">low_dim_rep</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">scatter_kwargs_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_categorical_scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">clr</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span>
                <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs_</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;pca_2d_visual_</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;1st principal component&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;2nd principal component&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer._plot_action_category_unique_values">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._plot_action_category_unique_values.html#tabensemb.trainer.Trainer._plot_action_category_unique_values">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_action_category_unique_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the category to classify data points and its unique values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df</span>
<span class="sd">            The dataframe. The returned Series has the same indices.</span>
<span class="sd">        category</span>
<span class="sd">            The category to classify data points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.Series</span>
<span class="sd">            The category</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Unique values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="c1"># Same as the procedure in OrdinalEncoder.</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">get_imputed_dtype</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">category</span><span class="p">])</span>
        <span class="n">category_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fill_cat_nan</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="n">category</span><span class="p">]],</span> <span class="p">{</span><span class="n">category</span><span class="p">:</span> <span class="n">dtype</span><span class="p">})[</span><span class="n">category</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span>
            <span class="k">else</span> <span class="n">df</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">category_data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">category_data</span><span class="p">,</span> <span class="n">unique_values</span></div>


<div class="viewcode-block" id="Trainer._plot_action_categorical_scatter">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._plot_action_categorical_scatter.html#tabensemb.trainer.Trainer._plot_action_categorical_scatter">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_action_categorical_scatter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span>
        <span class="n">scatter_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot scatters whose colors are related to their category.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x</span>
<span class="sd">            x-values of the scatter plot.</span>
<span class="sd">        y</span>
<span class="sd">            y-values of the scatter plot.</span>
<span class="sd">        df</span>
<span class="sd">            The dataframe whose ``category`` column is used to classify data points.</span>
<span class="sd">        category</span>
<span class="sd">            The column to classify data points.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        scatter_kwargs</span>
<span class="sd">            Arguments for ``plt.scatter``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">categories_inverse_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">category_data</span><span class="p">,</span> <span class="n">unique_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_category_unique_values</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_values</span><span class="p">):</span>
            <span class="n">colored_scatter_kwargs_</span> <span class="o">=</span> <span class="n">scatter_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">colored_scatter_kwargs_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">clr</span><span class="p">[</span><span class="n">idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">clr</span><span class="p">)],</span>
                    <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="n">global_marker</span><span class="p">[</span><span class="n">idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_marker</span><span class="p">)],</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">cat_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">category_data</span> <span class="o">==</span> <span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="n">cat_indices</span><span class="p">],</span>
                <span class="n">y</span><span class="p">[</span><span class="n">cat_indices</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cat</span><span class="p">),</span>
                <span class="o">**</span><span class="n">colored_scatter_kwargs_</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.plot_loss">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.plot_loss.html#tabensemb.trainer.Trainer.plot_loss">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_loss</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">train_val</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span>
        <span class="n">restored_epoch_mark</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">restored_epoch_mark_if_last</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plot_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scatter_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot loss curves for a model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        train_val</span>
<span class="sd">            &quot;train&quot; to plot training loss only. &quot;val&quot; to plot validation loss only. &quot;both&quot; to plot both of them.</span>
<span class="sd">        restored_epoch_mark</span>
<span class="sd">            Plot the best epoch from where the model is restored after training.</span>
<span class="sd">        restored_epoch_mark_if_last</span>
<span class="sd">            Plot the best epoch when it is the last epoch.</span>
<span class="sd">        legend</span>
<span class="sd">            Show legends.</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        plot_kwargs</span>
<span class="sd">            Arguments for ``plt.plot``</span>
<span class="sd">        scatter_kwargs</span>
<span class="sd">            Arguments for ``plt.scatter`` (used to plot the restored epoch).</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend``.</span>
<span class="sd">        figure_kwargs</span>
<span class="sd">            Arguments for ``plt.figure``.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr</span> <span class="o">=</span> <span class="n">global_palette</span> <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clr</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">plot_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">plot_kwargs</span><span class="p">)</span>
        <span class="n">scatter_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">marker</span><span class="o">=</span><span class="n">global_marker</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Best epoch&quot;</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">scatter_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">legend_kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_init_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">figure_kwargs_</span><span class="p">)</span>

        <span class="n">modelbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">)</span>
        <span class="n">train_ls</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">train_losses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">val_ls</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">val_losses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">restored_epoch</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">restored_epochs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">train_ls</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val_ls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The model base </span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2"> did not record losses during training in its attributes `train_losses` or &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`val_losses` (in the `_train_single_model` method). &quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">restored_epoch</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">restored_epoch_mark</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The model base </span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2"> did not record the best epoch from where the model is restored in its &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;attribute `restored_epochs`  (in the `_train_single_model` method)&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">train_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">train_ls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">train_plot_kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">train_plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">global_marker</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Training loss&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_ls</span><span class="p">)),</span> <span class="n">train_ls</span><span class="p">,</span> <span class="o">**</span><span class="n">train_plot_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">train_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">val_ls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val_plot_kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">val_plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">global_marker</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Validation loss&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val_ls</span><span class="p">)),</span> <span class="n">val_ls</span><span class="p">,</span> <span class="o">**</span><span class="n">val_plot_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">restored_epoch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">restored_epoch_mark</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">restored_epoch</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_ls</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">restored_epoch_mark_if_last</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">restored_epoch</span><span class="p">,</span>
                <span class="p">(</span><span class="n">val_ls</span> <span class="k">if</span> <span class="n">train_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">train_ls</span><span class="p">)[</span><span class="n">restored_epoch</span><span class="p">],</span>
                <span class="o">**</span><span class="n">scatter_kwargs_</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_action_after_plot</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;loss_</span><span class="si">{</span><span class="n">train_val</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">program</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
            <span class="p">),</span>
            <span class="n">disable</span><span class="o">=</span><span class="n">given_ax</span><span class="p">,</span>
            <span class="n">ax_or_fig</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Epoch&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> loss&quot;</span><span class="p">,</span>
            <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_show_close</span><span class="o">=</span><span class="n">save_show_close</span><span class="p">,</span>
            <span class="n">savefig_kwargs</span><span class="o">=</span><span class="n">savefig_kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer._plot_action_generate_feature_types_palette">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._plot_action_generate_feature_types_palette.html#tabensemb.trainer.Trainer._plot_action_generate_feature_types_palette">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_action_generate_feature_types_palette</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">clr</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate color palette for each feature according to their types defined in the configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        features</span>
<span class="sd">            A list of features to be plotted.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of colors for each feature. It can be used as the argument ``palette`` for seaborn functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">type_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">get_feature_types_idx</span><span class="p">(</span>
            <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">allow_unknown</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="n">clr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">type_idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">palette</span></div>


<div class="viewcode-block" id="Trainer._plot_action_generate_feature_types_legends">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._plot_action_generate_feature_types_legends.html#tabensemb.trainer.Trainer._plot_action_generate_feature_types_legends">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_action_generate_feature_types_legends</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">clr</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">legend_kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the legend for feature types defined in the configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        clr</span>
<span class="sd">            A seaborn color palette or an Iterable of colors. For example seaborn.color_palette(&quot;deep&quot;).</span>
<span class="sd">        ax</span>
<span class="sd">            ``matplotlib.axes.Axes``</span>
<span class="sd">        legend_kwargs</span>
<span class="sd">            Arguments for ``plt.legend``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.legend.Legend</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clr_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feature_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">unique_feature_types_with_derived</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">clr_map</span><span class="p">[</span><span class="n">feature_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">clr</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">legend_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span>
                <span class="n">handleheight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">fancybox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">legend_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">handles</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">clr_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">],</span>
            <span class="o">**</span><span class="n">legend_kwargs_</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">legend</span></div>


<div class="viewcode-block" id="Trainer._plot_action_init_ax">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._plot_action_init_ax.html#tabensemb.trainer.Trainer._plot_action_init_ax">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_action_init_ax</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figure_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="n">figure_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">figure_kwargs</span><span class="p">)</span>
        <span class="n">given_ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">given_ax</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">figure_kwargs_</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">return_fig</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">given_ax</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">return_fig</span> <span class="k">else</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">given_ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="Trainer._plot_action_after_plot">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._plot_action_after_plot.html#tabensemb.trainer.Trainer._plot_action_after_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_action_after_plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fig_name</span><span class="p">,</span>
        <span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">ax_or_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_show_close</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">savefig_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the labels of x/y-axis, set the layout, save the current figure, show the figure if in a notebook, and</span>
<span class="sd">        close the figure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fig_name</span>
<span class="sd">            The path to save the figure. Can be updated by ``savefig_kwargs`` using the key ``fname``</span>
<span class="sd">        ax_or_fig</span>
<span class="sd">            ``matplotlib.axes.Axes`` or ``matplotlib.figure.Figure``. If is a ``matplotlib.axes.Axes``, x/y-axis labels</span>
<span class="sd">            will be set using ``xlabel`` and ``ylabel``.</span>
<span class="sd">        disable</span>
<span class="sd">            True to disable the action. ``ax_or_fig`` is still returned.</span>
<span class="sd">        xlabel</span>
<span class="sd">            The label of the x-axis. Will be set only when ``ax_or_fig`` is a ``matplotlib.axes.Axes``.</span>
<span class="sd">        ylabel</span>
<span class="sd">            The label of the y-axis. Will be set only when ``ax_or_fig`` is a ``matplotlib.axes.Axes``.</span>
<span class="sd">        save_show_close</span>
<span class="sd">            Whether to save, show (in the notebook), and close the figure if ``ax`` is not given.</span>
<span class="sd">        tight_layout</span>
<span class="sd">            If True, ``plt.tight_layout`` is called.</span>
<span class="sd">        savefig_kwargs</span>
<span class="sd">            Arguments for ``plt.savefig``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes or matplotlib.figure.Figure</span>
<span class="sd">            Just the input ``ax_or_fig``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">disable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ax_or_fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_or_fig</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ax_or_fig</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ax_or_fig</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save_show_close</span><span class="p">:</span>
                <span class="n">savefig_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fig_name</span><span class="p">),</span> <span class="n">savefig_kwargs</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">savefig_kwargs_</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">**</span><span class="n">savefig_kwargs_</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ax_or_fig</span></div>


<div class="viewcode-block" id="Trainer._bootstrap_fit">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._bootstrap_fit.html#tabensemb.trainer.Trainer._bootstrap_fit">[docs]</a>
    <span class="k">def</span> <span class="nf">_bootstrap_fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">derived_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">focus_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">n_bootstrap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">grid_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">refit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">resample</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">percentile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">x_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">CI</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="n">average</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">inspect_attr_kwargs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make bootstrap resampling, fit the selected model on the resampled data, and assign sequential values to the</span>
<span class="sd">        selected feature to see how the prediction changes with respect to the feature.</span>

<span class="sd">        Cook, Thomas R., et al. Explaining Machine Learning by Bootstrapping Partial Dependence Functions and Shapley</span>
<span class="sd">        Values. No. RWP 21-12. 2021.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        program</span>
<span class="sd">            The selected model base.</span>
<span class="sd">        model_name</span>
<span class="sd">            The selected model in the model base.</span>
<span class="sd">        df</span>
<span class="sd">            The tabular dataset.</span>
<span class="sd">        derived_data</span>
<span class="sd">            The derived data calculated using :meth:`derive_unstacked`.</span>
<span class="sd">        focus_feature</span>
<span class="sd">            The feature to assign sequential values.</span>
<span class="sd">        n_bootstrap</span>
<span class="sd">            The number of bootstrapping, fitting, and assigning runs.</span>
<span class="sd">        grid_size</span>
<span class="sd">            The number of sequential values.</span>
<span class="sd">        refit</span>
<span class="sd">            Whether to fit the model on the bootstrap dataset (with warm_start=True).</span>
<span class="sd">        resample</span>
<span class="sd">            Whether to do bootstrap resampling. Only recommended to False when n_bootstrap=1.</span>
<span class="sd">        percentile</span>
<span class="sd">            The percentile of the feature used to generate sequential values.</span>
<span class="sd">        x_min</span>
<span class="sd">            The lower limit of the generated sequential values. It will override the left percentile.</span>
<span class="sd">        x_max</span>
<span class="sd">            The upper limit of the generated sequential values. It will override the right percentile.</span>
<span class="sd">        CI</span>
<span class="sd">            The confidence interval level to evaluate bootstrapped predictions.</span>
<span class="sd">        average</span>
<span class="sd">            If True, CI will be calculated on results ``(grid_size, n_bootstrap)``where predictions for all samples are</span>
<span class="sd">            averaged for each bootstrap run.</span>
<span class="sd">            If False, CI will be calculated on results ``(grid_size, n_bootstrap*len(df))``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The generated sequential values for the feature.</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Averaged predictions on the sequential values across multiple bootstrap runs and all samples.</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The left confidence interval.</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The right confidence interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">NoBayesOpt</span>

        <span class="n">modelbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelbase</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
        <span class="n">derived_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">sort_derived_data</span><span class="p">(</span><span class="n">derived_data</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">focus_feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_feature_names</span><span class="p">:</span>
            <span class="n">x_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_grid</span><span class="p">(</span>
                <span class="n">feature</span><span class="o">=</span><span class="n">focus_feature</span><span class="p">,</span>
                <span class="n">grid_size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
                <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">,</span>
                <span class="n">x_min</span><span class="o">=</span><span class="n">x_min</span><span class="p">,</span>
                <span class="n">x_max</span><span class="o">=</span><span class="n">x_max</span><span class="p">,</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">focus_feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat_feature_names</span><span class="p">:</span>
            <span class="n">x_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">focus_feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">focus_feature</span><span class="si">}</span><span class="s2"> not available.&quot;</span><span class="p">)</span>
        <span class="n">expected_value_bootstrap_replications</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">inspects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i_bootstrap</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstrap</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">resample</span><span class="p">:</span>
                <span class="n">df_bootstrap</span> <span class="o">=</span> <span class="n">skresample</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_bootstrap</span> <span class="o">=</span> <span class="n">df</span>
            <span class="n">tmp_derived_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">get_derived_data_slice</span><span class="p">(</span>
                <span class="n">derived_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_bootstrap</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">df_bootstrap</span> <span class="o">=</span> <span class="n">df_bootstrap</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">bootstrap_model</span> <span class="o">=</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">detach_model</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">refit</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">NoBayesOpt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="n">bootstrap_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
                        <span class="n">df_bootstrap</span><span class="p">,</span>
                        <span class="n">model_subset</span><span class="o">=</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span>
                        <span class="n">cont_feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">dataprocessors</span><span class="p">[</span>
                            <span class="mi">0</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">record_cont_features</span><span class="p">,</span>
                        <span class="n">cat_feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">dataprocessors</span><span class="p">[</span>
                            <span class="mi">0</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">record_cat_features</span><span class="p">,</span>
                        <span class="n">label_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_name</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="n">i_inspect</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bootstrap_model_predictions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_value</span><span class="p">:</span>
                <span class="n">df_perm</span> <span class="o">=</span> <span class="n">df_bootstrap</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">df_perm</span><span class="p">[</span><span class="n">focus_feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">inspect_attr_kwargs_</span> <span class="o">=</span> <span class="n">update_defaults_by_kwargs</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="p">[]),</span> <span class="n">inspect_attr_kwargs</span>
                <span class="p">)</span>
                <span class="n">inspect</span> <span class="o">=</span> <span class="n">bootstrap_model</span><span class="o">.</span><span class="n">inspect_attr</span><span class="p">(</span>
                    <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">df_perm</span><span class="p">,</span>
                    <span class="n">derived_data</span><span class="o">=</span><span class="p">(</span>
                        <span class="n">tmp_derived_data</span>
                        <span class="k">if</span> <span class="n">focus_feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_stacked_features</span>
                        <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">),</span>
                    <span class="o">**</span><span class="n">inspect_attr_kwargs_</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">bootstrap_model_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inspect</span><span class="p">[</span><span class="s2">&quot;USER_INPUT&quot;</span><span class="p">][</span><span class="s2">&quot;prediction&quot;</span><span class="p">])</span>
                <span class="n">i_inspect</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">inspect</span><span class="p">[</span><span class="s2">&quot;USER_INPUT&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">average</span><span class="p">:</span>
                <span class="n">expected_value_bootstrap_replications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">bootstrap_model_predictions</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expected_value_bootstrap_replications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">bootstrap_model_predictions</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">inspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_inspect</span><span class="p">)</span>

        <span class="n">expected_value_bootstrap_replications</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="n">expected_value_bootstrap_replications</span>
        <span class="p">)</span>
        <span class="n">ci_left</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ci_right</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mean_pred</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">expected_value_bootstrap_replications</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">expected_value_bootstrap_replications</span><span class="p">[:,</span> <span class="n">col_idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ci_int</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">CI</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ci_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">ci_left</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ci_int</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ci_right</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ci_int</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">mean_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">x_value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_pred</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ci_left</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ci_right</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">inspect_attr_kwargs</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">(</span>
                <span class="n">x_value</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_pred</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ci_left</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ci_right</span><span class="p">),</span>
                <span class="n">inspects</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer._generate_grid">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._generate_grid.html#tabensemb.trainer.Trainer._generate_grid">[docs]</a>
    <span class="k">def</span> <span class="nf">_generate_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">grid_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">percentile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">x_min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x_max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a sequential (linspace) grid for a feature in the tabular dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature</span>
<span class="sd">            The focused feature.</span>
<span class="sd">        grid_size</span>
<span class="sd">            The number of sequential values.</span>
<span class="sd">        percentile</span>
<span class="sd">            The percentile of the feature used to generate sequential values.</span>
<span class="sd">        x_min</span>
<span class="sd">            The lower limit of the generated sequential values. It will override the left percentile.</span>
<span class="sd">        x_max</span>
<span class="sd">            The upper limit of the generated sequential values. It will override the right percentile.</span>
<span class="sd">        df</span>
<span class="sd">            The tabular dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x_min</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">x_min</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x_max</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">x_max</span>
            <span class="p">),</span>
            <span class="n">grid_size</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer.load_state">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.load_state.html#tabensemb.trainer.Trainer.load_state">[docs]</a>
    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;Trainer&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore a :class:`Trainer` from a deep-copied state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trainer</span>
<span class="sd">            A deep-copied status of a :class:`Trainer`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># https://stackoverflow.com/questions/1216356/is-it-safe-to-replace-a-self-object-by-another-object-of-the-same-type-in-a-meth</span>
        <span class="n">current_root</span> <span class="o">=</span> <span class="n">cp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="c1"># The update operation does not change the location of self. However, model bases contains another trainer</span>
        <span class="c1"># that points to another location if the state is loaded from disk.</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">trainer</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">current_root</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">modelbase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelbases</span><span class="p">:</span>
            <span class="n">modelbase</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_root</span><span class="p">,</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">program</span><span class="p">))</span></div>


<div class="viewcode-block" id="Trainer.get_best_model">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer.get_best_model.html#tabensemb.trainer.Trainer.get_best_model">[docs]</a>
    <span class="k">def</span> <span class="nf">get_best_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the best model from :attr:`leaderboard`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The name of a model base where the best model is.</span>
<span class="sd">        model_name</span>
<span class="sd">            The name of the best model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;leaderboard&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_leaderboard</span><span class="p">(</span><span class="n">test_data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dump_trainer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leaderboard</span><span class="p">[</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leaderboard</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Trainer._metrics">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.Trainer._metrics.html#tabensemb.trainer.Trainer._metrics">[docs]</a>
    <span class="k">def</span> <span class="nf">_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">predictions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]],</span>
        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">test_data_only</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate metrics for predictions from :meth:`tabensemb.model.AbstractModel._predict_all`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        predictions</span>
<span class="sd">            Results from :meth:`tabensemb.model.AbstractModel._predict_all`.</span>
<span class="sd">        metrics</span>
<span class="sd">            The metrics that have been implemented in :func:`tabensemb.utils.utils.metric_sklearn`.</span>
<span class="sd">        test_data_only</span>
<span class="sd">            Whether to evaluate models only on testing datasets.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            A dataframe of metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_predictions</span> <span class="ow">in</span> <span class="n">predictions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_name</span>
            <span class="k">for</span> <span class="n">tvt</span><span class="p">,</span> <span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_true</span><span class="p">)</span> <span class="ow">in</span> <span class="n">model_predictions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">test_data_only</span> <span class="ow">and</span> <span class="n">tvt</span> <span class="o">!=</span> <span class="s2">&quot;Testing&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
                    <span class="n">metric_value</span> <span class="o">=</span> <span class="n">auto_metric_sklearn</span><span class="p">(</span>
                        <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">task</span>
                    <span class="p">)</span>
                    <span class="n">df</span><span class="p">[</span>
                        <span class="p">(</span>
                            <span class="n">tvt</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">test_data_only</span>
                            <span class="k">else</span> <span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                        <span class="p">)</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">metric_value</span>
            <span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_metrics</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_metrics</span></div>
</div>



<div class="viewcode-block" id="save_trainer">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.save_trainer.html#tabensemb.trainer.save_trainer">[docs]</a>
<span class="k">def</span> <span class="nf">save_trainer</span><span class="p">(</span>
    <span class="n">trainer</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pickling the :class:`Trainer` instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    trainer</span>
<span class="sd">        The :class:`Trainer` to be saved.</span>
<span class="sd">    path</span>
<span class="sd">        The folder path to save the :class:`Trainer`.</span>
<span class="sd">    verbose</span>
<span class="sd">        Verbosity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">pickle</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="s2">&quot;trainer.pkl&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">path</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outp</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">outp</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Trainer saved. To load the trainer, run trainer = load_trainer(path=&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="load_trainer">
<a class="viewcode-back" href="../../../api/generated/tabensemb.trainer.load_trainer.html#tabensemb.trainer.load_trainer">[docs]</a>
<span class="k">def</span> <span class="nf">load_trainer</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Trainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loading a pickled :class:`Trainer`. Paths of the :class:`Trainer` and its model bases (i.e. :attr:`project_root`,</span>
<span class="sd">    :attr:`tabensemb.model.AbstractModel.root`, :attr:`tabensemb.model.base.ModelDict.root`, and</span>
<span class="sd">    :meth:`tabensemb.model.base.ModelDict.model_path.keys`) will be changed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path</span>
<span class="sd">        Path of the :class:`Trainer`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    trainer</span>
<span class="sd">        The loaded :class:`Trainer`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">pickle</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inp</span><span class="p">:</span>
        <span class="n">trainer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">modelbase</span> <span class="ow">in</span> <span class="n">trainer</span><span class="o">.</span><span class="n">modelbases</span><span class="p">:</span>
        <span class="n">modelbase</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">modelbase</span><span class="o">.</span><span class="n">program</span><span class="p">))</span>
        <span class="n">modelbase</span><span class="o">.</span><span class="n">trainer</span> <span class="o">=</span> <span class="n">trainer</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">args</span>
    <span class="k">return</span> <span class="n">trainer</span></div>

</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright 2023, Tabular Ensemble developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>